<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financeiro - ScanHub</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #44689a;
            --secondary-color: #33c47;
            --light-color: #e8ecef;
            --dark-color: #2c3e50;
            --white: #ffffff;
            --receita-color: #27ae60;
            --despesa-color: #e74c3c;
            --saldo-color: #3498db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
            padding-top: 70px;
        }

        /* NAVBAR CORRIGIDA */
        .navbar-dashboard {
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 10px 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 70px;
            display: flex;
            align-items: center;
        }

        .navbar-dashboard .container-fluid {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0;
        }

        /* Logo */
        .navbar-brand-dashboard {
            display: flex;
            align-items: center;
            height: 50px;
        }

        .navbar-brand-dashboard img {
            height: 100%;
            width: auto;
            max-width: 150px;
            object-fit: contain;
        }

        /* Menu Mobile Toggle */
        .mobile-menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark-color);
            padding: 5px 10px;
            margin-right: 10px;
        }

        /* User Info Mobile */
        .user-info-mobile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        /* MENU DASHBOARD CORRIGIDO */
        .dashboard-menu-container {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            background: white;
            z-index: 999;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 20px 20px;
            display: none;
            overflow: hidden;
            max-height: 80vh;
            overflow-y: auto;
        }

        .dashboard-menu-container.show {
            display: block;
        }

        .dashboard-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        .dashboard-menu li {
            width: 100%;
        }

        .dashboard-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--dark-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 1px solid #f0f0f0;
        }

        .dashboard-menu a:hover,
        .dashboard-menu a.active {
            background: rgba(68, 104, 154, 0.1);
            color: var(--primary-color);
        }

        .dashboard-menu i {
            font-size: 1.2rem;
            width: 30px;
            text-align: center;
            margin-right: 10px;
        }

        /* Main Content */
        .main-content {
            padding: 20px 15px;
            min-height: calc(100vh - 70px);
        }

        .welcome-card {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
        }

        .welcome-card h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .welcome-card p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Stats Cards - RESPONSIVO */
        .stats-financeiro {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-card.saldo {
            border-top: 3px solid var(--saldo-color);
        }

        .stat-card.receita {
            border-top: 3px solid var(--receita-color);
        }

        .stat-card.despesa {
            border-top: 3px solid var(--despesa-color);
        }

        .stat-card i {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .stat-card.saldo i { color: var(--saldo-color); }
        .stat-card.receita i { color: var(--receita-color); }
        .stat-card.despesa i { color: var(--despesa-color); }

        .stat-card h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .stat-card p {
            font-size: 0.8rem;
            color: #666;
        }

        /* Gr√°ficos - RESPONSIVO */
        .graficos-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .grafico-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }

        .grafico-card h5 {
            margin-bottom: 15px;
            color: var(--dark-color);
            font-weight: 600;
            font-size: 1rem;
        }

        .grafico-card canvas {
            width: 100% !important;
            height: 200px !important;
        }

        /* Abas Financeiro - RESPONSIVO */
        .financeiro-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 10px;
            border: 1px solid #e8ecef;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            min-width: calc(50% - 5px);
            padding: 10px 5px;
            border: none;
            background: transparent;
            color: #666;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .tab-btn i {
            font-size: 1rem;
        }

        .tab-btn:hover {
            background: rgba(68, 104, 154, 0.1);
            color: var(--primary-color);
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 2px 8px rgba(68, 104, 154, 0.3);
        }

        /* Bot√µes Principais - RESPONSIVO */
        .main-buttons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn-primary-action {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-primary-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        /* Search and Filter - RESPONSIVO */
        .search-filter-container {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin-bottom: 15px;
        }

        .search-filter-container .row {
            margin: 0 -5px;
        }

        .search-filter-container .col-md-3,
        .search-filter-container .col-md-2,
        .search-filter-container .col-md-1 {
            padding: 0 5px;
            margin-bottom: 10px;
        }

        /* Tabelas - RESPONSIVO */
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin-top: 15px;
            overflow-x: auto;
        }

        .table {
            margin: 0;
            min-width: 800px;
        }

        .table thead th {
            background: #f8f9fa;
            border-bottom: 2px solid #e8ecef;
            font-weight: 600;
            color: var(--dark-color);
            padding: 12px 8px;
            font-size: 0.85rem;
        }

        .table tbody td {
            padding: 12px 8px;
            vertical-align: middle;
            border-color: #e8ecef;
            font-size: 0.85rem;
        }

        /* Badges de Status */
        .badge-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .status-pago {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .status-pendente {
            background: rgba(241, 196, 15, 0.1);
            color: #f39c12;
        }

        .status-atrasado {
            background: rgba(231, 76, 60, 0.1);
            color: #c0392b;
        }

        /* A√ß√µes */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-action-sm {
            padding: 5px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            border: none;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #666;
        }

        .btn-action-sm:hover {
            transform: translateY(-1px);
        }

        /* Calculadora Flutuante */
        .calculadora-flutuante {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .calculadora-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calculadora-btn:hover {
            transform: scale(1.1);
        }

        .calculadora-panel {
            position: absolute;
            bottom: 60px;
            right: 0;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            width: 280px;
            display: none;
        }

        .calculadora-panel.show {
            display: block;
        }

        .calculadora-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            text-align: right;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 12px;
            min-height: 50px;
            word-break: break-all;
            border: 1px solid #ddd;
        }

        .calculadora-botoes {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .calc-btn {
            padding: 10px 5px;
            border: none;
            border-radius: 6px;
            background: #f8f9fa;
            color: #333;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .calc-btn:hover {
            background: #e9ecef;
        }

        .calc-btn.operador {
            background: #3498db;
            color: white;
        }

        .calc-btn.calcular {
            background: #27ae60;
            color: white;
            grid-column: span 2;
        }

        .calc-btn.limpar {
            background: #e74c3c;
            color: white;
        }

        /* Modal Responsivo */
        .modal-dialog {
            margin: 20px auto;
            max-width: 95%;
        }

        .modal-content {
            border-radius: 12px;
            border: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            padding: 15px 20px;
            border: none;
        }

        .modal-header .btn-close {
            filter: brightness(0) invert(1);
            opacity: 0.8;
        }

        /* Desktop */
        @media (min-width: 768px) {
            body {
                padding-top: 70px;
            }
            
            .dashboard-menu-container {
                position: static;
                display: block !important;
                box-shadow: none;
                border-radius: 0;
                max-height: none;
                background: transparent;
                margin-top: 10px;
            }
            
            .dashboard-menu {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 5px;
                justify-content: center;
            }
            
            .dashboard-menu li {
                width: auto;
                flex: 1;
                min-width: 100px;
            }
            
            .dashboard-menu a {
                flex-direction: column;
                padding: 10px 5px;
                border-bottom: none;
                border-radius: 8px;
                text-align: center;
                font-size: 0.8rem;
            }
            
            .dashboard-menu i {
                margin-right: 0;
                margin-bottom: 5px;
                font-size: 1.1rem;
            }
            
            .mobile-menu-toggle {
                display: none;
            }
            
            .stats-financeiro {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .financeiro-tabs {
                flex-wrap: nowrap;
            }
            
            .tab-btn {
                min-width: auto;
                padding: 10px 15px;
                flex-direction: row;
                font-size: 0.9rem;
            }
            
            .tab-btn i {
                margin-right: 5px;
            }
            
            .main-content {
                padding: 20px 30px;
            }
        }

        @media (min-width: 992px) {
            .stats-financeiro {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .graficos-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grafico-card:last-child {
                grid-column: span 2;
            }
            
            .main-content {
                padding: 20px 40px;
            }
        }

        /* Mobile espec√≠fico */
        @media (max-width: 576px) {
            .main-buttons-container {
                flex-direction: column;
            }
            
            .btn-primary-action {
                width: 100%;
            }
            
            .calculadora-panel {
                width: calc(100vw - 40px);
                right: -50px;
            }
            
            .navbar-brand-dashboard img {
                max-width: 120px;
            }
            
            .user-details h5 {
                font-size: 0.9rem;
            }
            
            .user-details small {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar Dashboard -->
    <nav class="navbar navbar-dashboard">
        <div class="container-fluid">
            <!-- Logo -->
            <a class="navbar-brand-dashboard" href="#">
                <img src="logoscanhub.png" alt="ScanHub">
            </a>

            <!-- Bot√£o Menu Mobile -->
            <button class="mobile-menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>

            <!-- User Info -->
            <div class="user-info-mobile">
                <div class="user-avatar" id="userAvatar">?</div>
                <div class="user-details">
                    <h5 id="userName" class="mb-0">Carregando...</h5>
                    <small>ID: <span id="userId">---</span></small>
                </div>

                <!-- Bot√£o Logout -->
                <button class="btn btn-outline-danger btn-sm ms-2" id="btnLogout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Menu Dashboard -->
    <div class="dashboard-menu-container" id="dashboardMenu">
        <ul class="dashboard-menu">
            <li>
                <a href="profissional-dashboard.html">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="perfil-profissional.html">
                    <i class="fas fa-user"></i>
                    <span>Perfil</span>
                </a>
            </li>
            <li>
                <a href="meus-clientes.html">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
            </li>
            <li>
                <a href="financeiro.html" class="active">
                    <i class="fas fa-chart-line"></i>
                    <span>Financeiro</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Agenda</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-tools"></i>
                    <span>Servi√ßos</span>
                </a>
            </li>
            <li>
                <a href="pedidos.html">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Pedidos</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-crown"></i>
                    <span>Assinatura</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-cog"></i>
                    <span>Configura√ß√µes</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Welcome Card -->
        <div class="welcome-card">
            <h1>Financeiro üí∞</h1>
            <p>Controle completo das suas finan√ßas - Receitas, Despesas e An√°lises</p>
        </div>

        <!-- Stats -->
        <div class="stats-financeiro">
            <div class="stat-card saldo">
                <i class="fas fa-wallet"></i>
                <h3 id="saldoAtual">R$ 0,00</h3>
                <p>Saldo Atual</p>
            </div>
            <div class="stat-card receita">
                <i class="fas fa-money-bill-wave"></i>
                <h3 id="receitaMes">R$ 0,00</h3>
                <p>Receita (M√™s)</p>
            </div>
            <div class="stat-card despesa">
                <i class="fas fa-shopping-cart"></i>
                <h3 id="despesaMes">R$ 0,00</h3>
                <p>Despesas (M√™s)</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-exclamation-triangle"></i>
                <h3 id="atrasados">R$ 0,00</h3>
                <p>Pagamentos Atrasados</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-calendar-day"></i>
                <h3 id="aReceber">R$ 0,00</h3>
                <p>A Receber (7 dias)</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-calendar-times"></i>
                <h3 id="aPagar">R$ 0,00</h3>
                <p>A Pagar (7 dias)</p>
            </div>
        </div>

        <!-- Gr√°ficos -->
        <div class="graficos-container">
            <div class="grafico-card">
                <h5>Fluxo de Caixa</h5>
                <canvas id="graficoFluxoCaixa"></canvas>
            </div>
            <div class="grafico-card">
                <h5>Distribui√ß√£o de Despesas</h5>
                <canvas id="graficoDespesas"></canvas>
            </div>
            <div class="grafico-card">
                <h5>Comparativo Receita x Despesa</h5>
                <canvas id="graficoComparativo"></canvas>
            </div>
        </div>

        <!-- Abas -->
        <div class="financeiro-tabs" id="financeiroTabs">
            <button class="tab-btn active" data-tipo="todas">
                <i class="fas fa-list"></i>
                <span>Todas</span>
            </button>
            <button class="tab-btn" data-tipo="receitas">
                <i class="fas fa-arrow-down"></i>
                <span>Receitas</span>
            </button>
            <button class="tab-btn" data-tipo="despesas">
                <i class="fas fa-arrow-up"></i>
                <span>Despesas</span>
            </button>
            <button class="tab-btn" data-tipo="categorias">
                <i class="fas fa-tags"></i>
                <span>Categorias</span>
            </button>
            <button class="tab-btn" data-tipo="relatorios">
                <i class="fas fa-file-alt"></i>
                <span>Relat√≥rios</span>
            </button>
        </div>

        <!-- Bot√µes Principais -->
        <div class="main-buttons-container">
            <button class="btn btn-primary-action" id="btnNovaReceita">
                <i class="fas fa-plus-circle"></i> Nova Receita
            </button>
            <button class="btn btn-primary-action" id="btnNovaDespesa">
                <i class="fas fa-minus-circle"></i> Nova Despesa
            </button>
            <button class="btn btn-primary-action" id="btnExportar">
                <i class="fas fa-download"></i> Exportar
            </button>
            <button class="btn btn-primary-action" id="btnNovaCategoria">
                <i class="fas fa-plus"></i> Nova Categoria
            </button>
        </div>

        <!-- Search and Filter -->
        <div class="search-filter-container">
            <div class="row">
                <div class="col-12 col-md-6 col-lg-3 mb-2">
                    <input type="text" class="form-control" id="searchMovimentacoes" placeholder="üîç Buscar...">
                </div>
                <div class="col-6 col-md-3 col-lg-2 mb-2">
                    <select class="form-select" id="filterTipo">
                        <option value="">Tipo</option>
                        <option value="receita">Receitas</option>
                        <option value="despesa">Despesas</option>
                    </select>
                </div>
                <div class="col-6 col-md-3 col-lg-2 mb-2">
                    <select class="form-select" id="filterStatus">
                        <option value="">Status</option>
                        <option value="pago">Pago</option>
                        <option value="pendente">Pendente</option>
                        <option value="atrasado">Atrasado</option>
                    </select>
                </div>
                <div class="col-6 col-md-3 col-lg-2 mb-2">
                    <select class="form-select" id="filterMes">
                        <option value="">M√™s</option>
                        <option value="1">Jan</option>
                        <option value="2">Fev</option>
                        <option value="3">Mar</option>
                        <option value="4">Abr</option>
                        <option value="5">Mai</option>
                        <option value="6">Jun</option>
                        <option value="7">Jul</option>
                        <option value="8">Ago</option>
                        <option value="9">Set</option>
                        <option value="10">Out</option>
                        <option value="11">Nov</option>
                        <option value="12">Dez</option>
                    </select>
                </div>
                <div class="col-6 col-md-3 col-lg-2 mb-2">
                    <select class="form-select" id="filterCategoria">
                        <option value="">Categoria</option>
                    </select>
                </div>
                <div class="col-12 col-md-3 col-lg-1 mb-2">
                    <button class="btn btn-primary w-100" id="btnAplicarFiltros">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabela de Movimenta√ß√µes -->
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Descri√ß√£o</th>
                            <th>Categoria</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Vencimento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="movimentacoesTable">
                        <tr id="emptyState">
                            <td colspan="8" class="text-center py-4">
                                <i class="fas fa-chart-line fa-2x text-muted mb-2"></i>
                                <h6 class="text-muted">Nenhuma movimenta√ß√£o</h6>
                                <p class="text-muted mb-0">Comece cadastrando uma receita ou despesa</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Se√ß√£o de Categorias (oculta por padr√£o) -->
        <div class="table-container mt-3" id="categoriasSection" style="display: none;">
            <div class="d-flex justify-content-between align-items-center p-3">
                <h5 class="mb-0">Categorias</h5>
            </div>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Categoria</th>
                            <th>Tipo</th>
                            <th>Valor Total</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="categoriasTable">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Se√ß√£o de Relat√≥rios (oculta por padr√£o) -->
        <div class="row mt-3" id="relatoriosSection" style="display: none;">
            <div class="col-12">
                <div class="grafico-card">
                    <h5>Relat√≥rios</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Per√≠odo</label>
                            <select class="form-select" id="periodoRelatorio">
                                <option value="este_mes">Este M√™s</option>
                                <option value="ultimo_mes">√öltimo M√™s</option>
                                <option value="ultimos_3_meses">√öltimos 3 Meses</option>
                                <option value="este_ano">Este Ano</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-grid gap-2 d-md-flex">
                        <button class="btn btn-primary-action flex-fill" id="btnRelatorioCompleto">
                            <i class="fas fa-file-pdf"></i> Relat√≥rio Completo
                        </button>
                        <button class="btn btn-outline-primary flex-fill" id="btnRelatorioSimples">
                            <i class="fas fa-chart-pie"></i> Relat√≥rio Resumido
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculadora Flutuante -->
    <div class="calculadora-flutuante">
        <div class="calculadora-panel" id="calculadoraPanel">
            <div class="calculadora-display" id="calcDisplay">0</div>
            <div class="calculadora-botoes">
                <button class="calc-btn limpar" onclick="calcLimpar()">C</button>
                <button class="calc-btn" onclick="calcPorcentagem()">%</button>
                <button class="calc-btn operador" onclick="calcOperador('/')">√∑</button>
                
                <button class="calc-btn" onclick="calcNumero('7')">7</button>
                <button class="calc-btn" onclick="calcNumero('8')">8</button>
                <button class="calc-btn" onclick="calcNumero('9')">9</button>
                <button class="calc-btn operador" onclick="calcOperador('*')">√ó</button>
                
                <button class="calc-btn" onclick="calcNumero('4')">4</button>
                <button class="calc-btn" onclick="calcNumero('5')">5</button>
                <button class="calc-btn" onclick="calcNumero('6')">6</button>
                <button class="calc-btn operador" onclick="calcOperador('-')">-</button>
                
                <button class="calc-btn" onclick="calcNumero('1')">1</button>
                <button class="calc-btn" onclick="calcNumero('2')">2</button>
                <button class="calc-btn" onclick="calcNumero('3')">3</button>
                <button class="calc-btn operador" onclick="calcOperador('+')">+</button>
                
                <button class="calc-btn" onclick="calcNumero('0')">0</button>
                <button class="calc-btn" onclick="calcPonto()">,</button>
                <button class="calc-btn calcular" onclick="calcCalcular()">=</button>
            </div>
        </div>
        <button class="calculadora-btn" id="toggleCalculadora">
            <i class="fas fa-calculator"></i>
        </button>
    </div>

    <!-- Modal Movimenta√ß√£o -->
    <div class="modal fade" id="modalMovimentacao" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Nova Movimenta√ß√£o</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formMovimentacao">
                        <input type="hidden" id="movimentacaoId">
                        <input type="hidden" id="tipoMovimentacao" value="receita">
                        
                        <div class="row mb-3">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Tipo *</label>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-outline-success flex-fill tipo-mov-btn active" data-tipo="receita" id="tipoReceitaBtn">
                                        <i class="fas fa-arrow-down me-1"></i>Receita
                                    </button>
                                    <button type="button" class="btn btn-outline-danger flex-fill tipo-mov-btn" data-tipo="despesa" id="tipoDespesaBtn">
                                        <i class="fas fa-arrow-up me-1"></i>Despesa
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Data *</label>
                                <input type="date" class="form-control" id="dataMovimentacao" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Descri√ß√£o *</label>
                                <input type="text" class="form-control" id="descricao" required placeholder="Ex: Pagamento do cliente...">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Categoria *</label>
                                <select class="form-select" id="categoria" required>
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Valor (R$) *</label>
                                <input type="number" class="form-control" id="valor" min="0" step="0.01" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Status *</label>
                                <select class="form-select" id="status" required>
                                    <option value="pendente">Pendente</option>
                                    <option value="pago">Pago/Recebido</option>
                                    <option value="atrasado">Atrasado</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Vencimento *</label>
                                <input type="date" class="form-control" id="vencimento" required>
                            </div>
                        </div>

                        <div class="row mb-3" id="receitaFields">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Cliente (opcional)</label>
                                <select class="form-select" id="cliente">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3" id="despesaFields" style="display: none;">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Fornecedor</label>
                                <input type="text" class="form-control" id="fornecedor" placeholder="Nome do fornecedor">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Observa√ß√µes</label>
                            <textarea class="form-control" id="observacoes" rows="2" placeholder="Observa√ß√µes..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary-action" id="btnSalvarMovimentacao">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Categoria -->
    <div class="modal fade" id="modalCategoria" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nova Categoria</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formCategoria">
                        <div class="mb-3">
                            <label class="form-label">Nome da Categoria *</label>
                            <input type="text" class="form-control" id="nomeCategoria" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tipo *</label>
                            <select class="form-select" id="tipoCategoria" required>
                                <option value="despesa">Despesa</option>
                                <option value="receita">Receita</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Cor de Identifica√ß√£o</label>
                            <input type="color" class="form-control form-control-color" id="corCategoria" value="#3498db">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary-action" id="btnSalvarCategoria">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js"></script>
    
    <script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyAYqWTg2RAr4IbqxRsl58TZGQ9tKnyFK14",
        authDomain: "scanhub-ed512.firebaseapp.com",
        projectId: "scanhub-ed512",
        storageBucket: "scanhub-ed512.firebasestorage.app",
        messagingSenderId: "1083305018831",
        appId: "1:1083305018831:web:f7594d560439c8965c3eba"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ============================================
    // VARI√ÅVEIS GLOBAIS
    // ============================================
    let currentUser = null;
    let userData = null;
    let movimentacoes = [];
    let categorias = [];
    let clientes = [];
    let tipoAtualAba = 'todas';

    // Vari√°veis da Calculadora
    let calcDisplay = '0';
    let calcValor1 = null;
    let calcOperador = null;
    let calcLimparDisplay = false;

    // ============================================
    // INICIALIZA√á√ÉO
    // ============================================

    // Monitorar autentica√ß√£o
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            currentUser = user;
            try {
                const userDoc = await db.collection("usuarios").doc(user.uid).get();
                if (userDoc.exists) {
                    userData = userDoc.data();
                    atualizarInterfaceUsuario();
                    await carregarDadosIniciais();
                    inicializarSistema();
                }
            } catch (error) {
                alert('Erro ao carregar dados do usu√°rio');
            }
        } else {
            window.location.href = 'login.html';
        }
    });

    function atualizarInterfaceUsuario() {
        if (userData && userData.apelido) {
            document.getElementById('userName').textContent = userData.apelido;
            document.getElementById('userAvatar').textContent = userData.apelido.charAt(0).toUpperCase();
            if (userData.idScanHub) {
                document.getElementById('userId').textContent = userData.idScanHub;
            }
        }
    }

    async function carregarDadosIniciais() {
        await carregarCategorias();
        await carregarMovimentacoes();
        await carregarClientes();
        atualizarFiltros();
        atualizarEstatisticas();
    }

    async function carregarMovimentacoes() {
        try {
            const querySnapshot = await db.collection("movimentacoes")
                .where("profissionalId", "==", currentUser.uid)
                .orderBy("data", "desc")
                .get();
            
            movimentacoes = [];
            querySnapshot.forEach((doc) => {
                movimentacoes.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            atualizarTabelaMovimentacoes();
        } catch (error) {
            console.error("Erro ao carregar movimenta√ß√µes:", error);
        }
    }

    async function carregarCategorias() {
        try {
            const querySnapshot = await db.collection("categorias")
                .where("profissionalId", "==", currentUser.uid)
                .get();
            
            categorias = [];
            querySnapshot.forEach((doc) => {
                categorias.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            if (categorias.length === 0) {
                await criarCategoriasPadrao();
            }
        } catch (error) {
            console.error("Erro ao carregar categorias:", error);
        }
    }

    async function criarCategoriasPadrao() {
        const categoriasPadrao = [
            { nome: "Sal√°rio", tipo: "receita", cor: "#27ae60" },
            { nome: "Freelance", tipo: "receita", cor: "#2ecc71" },
            { nome: "Vendas", tipo: "receita", cor: "#3498db" },
            { nome: "Aluguel", tipo: "despesa", cor: "#e74c3c" },
            { nome: "Contas", tipo: "despesa", cor: "#f39c12" },
            { nome: "Internet", tipo: "despesa", cor: "#9b59b6" },
            { nome: "Transporte", tipo: "despesa", cor: "#34495e" },
            { nome: "Alimenta√ß√£o", tipo: "despesa", cor: "#1abc9c" },
            { nome: "Materiais", tipo: "despesa", cor: "#d35400" }
        ];
        
        try {
            for (const categoria of categoriasPadrao) {
                await db.collection("categorias").add({
                    ...categoria,
                    profissionalId: currentUser.uid,
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            await carregarCategorias();
        } catch (error) {
            console.error("Erro ao criar categorias padr√£o:", error);
        }
    }

    async function carregarClientes() {
        try {
            const querySnapshot = await db.collection("clientes")
                .where("profissionalId", "==", currentUser.uid)
                .where("status", "==", "ativo")
                .get();
            
            clientes = [];
            querySnapshot.forEach((doc) => {
                clientes.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
        } catch (error) {
            console.error("Erro ao carregar clientes:", error);
        }
    }

    function atualizarFiltros() {
        const filterCategoriaSelect = document.getElementById('filterCategoria');
        const categoriaSelect = document.getElementById('categoria');
        const clienteSelect = document.getElementById('cliente');
        
        if (filterCategoriaSelect) {
            filterCategoriaSelect.innerHTML = '<option value="">Categoria</option>';
            categorias.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria.id;
                option.textContent = categoria.nome;
                filterCategoriaSelect.appendChild(option);
            });
        }
        
        if (categoriaSelect) {
            categoriaSelect.innerHTML = '<option value="">Selecione...</option>';
            categorias.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria.id;
                option.textContent = categoria.nome;
                option.style.color = categoria.cor || '#333';
                categoriaSelect.appendChild(option);
            });
        }
        
        if (clienteSelect) {
            clienteSelect.innerHTML = '<option value="">Selecione...</option>';
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.nome || cliente.email;
                clienteSelect.appendChild(option);
            });
        }
    }

    // ============================================
    // FUN√á√ïES DA INTERFACE
    // ============================================

    function inicializarSistema() {
        inicializarCalculadora();
        inicializarAbas();
        inicializarEventListeners();
        inicializarGraficos();
    }

    // ============================================
    // CALCULADORA FUNCIONAL
    // ============================================

    function inicializarCalculadora() {
        const toggleCalculadora = document.getElementById('toggleCalculadora');
        const calculadoraPanel = document.getElementById('calculadoraPanel');
        
        toggleCalculadora.addEventListener('click', () => {
            calculadoraPanel.classList.toggle('show');
        });
        
        document.addEventListener('click', (e) => {
            if (!calculadoraPanel.contains(e.target) && !toggleCalculadora.contains(e.target)) {
                calculadoraPanel.classList.remove('show');
            }
        });
    }

    function calcNumero(numero) {
        if (calcLimparDisplay) {
            calcDisplay = numero;
            calcLimparDisplay = false;
        } else {
            calcDisplay = calcDisplay === '0' ? numero : calcDisplay + numero;
        }
        document.getElementById('calcDisplay').textContent = calcDisplay;
    }

    function calcPonto() {
        if (calcLimparDisplay) {
            calcDisplay = '0.';
            calcLimparDisplay = false;
        } else if (!calcDisplay.includes('.')) {
            calcDisplay += '.';
        }
        document.getElementById('calcDisplay').textContent = calcDisplay;
    }

    function calcOperador(operador) {
        const valorDisplay = parseFloat(calcDisplay.replace(',', '.'));
        
        if (calcValor1 === null) {
            calcValor1 = valorDisplay;
        } else if (calcOperador) {
            const resultado = calcular(calcValor1, valorDisplay, calcOperador);
            calcDisplay = String(resultado).replace('.', ',');
            document.getElementById('calcDisplay').textContent = calcDisplay;
            calcValor1 = resultado;
        }
        
        calcOperador = operador;
        calcLimparDisplay = true;
    }

    function calcCalcular() {
        if (calcValor1 === null || calcOperador === null) return;
        
        const valor2 = parseFloat(calcDisplay.replace(',', '.'));
        const resultado = calcular(calcValor1, valor2, calcOperador);
        
        calcDisplay = String(resultado).replace('.', ',');
        document.getElementById('calcDisplay').textContent = calcDisplay;
        
        calcValor1 = resultado;
        calcOperador = null;
        calcLimparDisplay = true;
    }

    function calcPorcentagem() {
        const valor = parseFloat(calcDisplay.replace(',', '.'));
        
        if (calcValor1 !== null && calcOperador) {
            const porcentagem = (calcValor1 * valor) / 100;
            calcDisplay = String(porcentagem).replace('.', ',');
        } else {
            calcDisplay = String(valor / 100).replace('.', ',');
        }
        
        document.getElementById('calcDisplay').textContent = calcDisplay;
        calcLimparDisplay = true;
    }

    function calcLimpar() {
        calcDisplay = '0';
        calcValor1 = null;
        calcOperador = null;
        calcLimparDisplay = false;
        document.getElementById('calcDisplay').textContent = calcDisplay;
    }

    function calcular(a, b, operador) {
        switch(operador) {
            case '+': return a + b;
            case '-': return a - b;
            case '*': return a * b;
            case '/': return b !== 0 ? a / b : 0;
            default: return b;
        }
    }

    // ============================================
    // TABELAS E FILTROS
    // ============================================

    function atualizarTabelaMovimentacoes() {
        const searchTerm = document.getElementById('searchMovimentacoes').value.toLowerCase();
        const tipoFilter = document.getElementById('filterTipo').value;
        const statusFilter = document.getElementById('filterStatus').value;
        const categoriaFilter = document.getElementById('filterCategoria').value;
        
        let movimentacoesFiltradas = movimentacoes;
        
        if (tipoAtualAba === 'receitas') {
            movimentacoesFiltradas = movimentacoes.filter(m => m.tipo === 'receita');
        } else if (tipoAtualAba === 'despesas') {
            movimentacoesFiltradas = movimentacoes.filter(m => m.tipo === 'despesa');
        }
        
        movimentacoesFiltradas = movimentacoesFiltradas.filter(mov => {
            const matchSearch = !searchTerm || 
                (mov.descricao && mov.descricao.toLowerCase().includes(searchTerm));
            const matchTipo = !tipoFilter || mov.tipo === tipoFilter;
            const matchStatus = !statusFilter || mov.status === statusFilter;
            const matchCategoria = !categoriaFilter || mov.categoriaId === categoriaFilter;
            
            return matchSearch && matchTipo && matchStatus && matchCategoria;
        });
        
        const tbody = document.getElementById('movimentacoesTable');
        tbody.innerHTML = '';
        
        if (movimentacoesFiltradas.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" class="text-center py-4">
                        <i class="fas fa-chart-line fa-2x text-muted mb-2"></i>
                        <h6 class="text-muted">Nenhuma movimenta√ß√£o encontrada</h6>
                    </td>
                </tr>
            `;
            return;
        }
        
        movimentacoesFiltradas.forEach(mov => {
            const categoria = categorias.find(c => c.id === mov.categoriaId);
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${formatarData(mov.data)}</td>
                <td>
                    <span class="badge ${mov.tipo === 'receita' ? 'bg-success' : 'bg-danger'}">
                        ${mov.tipo === 'receita' ? 'Receita' : 'Despesa'}
                    </span>
                </td>
                <td>${mov.descricao || ''}</td>
                <td>
                    <span class="badge" style="background: ${categoria?.cor || '#ccc'}">
                        ${categoria?.nome || 'Sem categoria'}
                    </span>
                </td>
                <td class="${mov.tipo === 'receita' ? 'text-success' : 'text-danger'} fw-bold">
                    ${mov.tipo === 'receita' ? '+' : '-'} ${formatarMoeda(mov.valor)}
                </td>
                <td>
                    <span class="badge-status ${getStatusClass(mov.status)}">
                        ${getStatusTexto(mov.status)}
                    </span>
                </td>
                <td>${formatarData(mov.vencimento)}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-action-sm" onclick="editarMovimentacao('${mov.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-action-sm" onclick="excluirMovimentacao('${mov.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            
            tbody.appendChild(row);
        });
    }

    function atualizarTabelaCategorias() {
        const tbody = document.getElementById('categoriasTable');
        tbody.innerHTML = '';
        
        if (categorias.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="4" class="text-center py-4">
                        <p class="text-muted">Nenhuma categoria cadastrada</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        categorias.forEach(categoria => {
            const total = movimentacoes
                .filter(m => m.categoriaId === categoria.id)
                .reduce((sum, m) => sum + (m.valor || 0), 0);
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <span class="badge" style="background: ${categoria.cor || '#3498db'}">
                        ${categoria.nome}
                    </span>
                </td>
                <td>
                    <span class="badge ${categoria.tipo === 'receita' ? 'bg-success' : 'bg-danger'}">
                        ${categoria.tipo === 'receita' ? 'Receita' : 'Despesa'}
                    </span>
                </td>
                <td>${formatarMoeda(total)}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-action-sm" onclick="editarCategoria('${categoria.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-action-sm" onclick="excluirCategoria('${categoria.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            
            tbody.appendChild(row);
        });
    }

    function getStatusClass(status) {
        switch(status) {
            case 'pago': return 'status-pago';
            case 'pendente': return 'status-pendente';
            case 'atrasado': return 'status-atrasado';
            default: return '';
        }
    }

    function getStatusTexto(status) {
        switch(status) {
            case 'pago': return 'Pago';
            case 'pendente': return 'Pendente';
            case 'atrasado': return 'Atrasado';
            default: return status;
        }
    }

    function formatarData(data) {
        if (!data) return '-';
        const date = data.toDate ? data.toDate() : new Date(data);
        return date.toLocaleDateString('pt-BR');
    }

    function formatarMoeda(valor) {
        if (!valor && valor !== 0) return 'R$ 0,00';
        return new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL'
        }).format(valor);
    }

    // ============================================
    // ABAS DO FINANCEIRO
    // ============================================

    function inicializarAbas() {
        const tabButtons = document.querySelectorAll('.tab-btn');
        const categoriasSection = document.getElementById('categoriasSection');
        const relatoriosSection = document.getElementById('relatoriosSection');
        
        tabButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                tabButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                tipoAtualAba = this.getAttribute('data-tipo');
                
                categoriasSection.style.display = tipoAtualAba === 'categorias' ? 'block' : 'none';
                relatoriosSection.style.display = tipoAtualAba === 'relatorios' ? 'block' : 'none';
                
                if (tipoAtualAba === 'categorias') {
                    atualizarTabelaCategorias();
                } else {
                    atualizarTabelaMovimentacoes();
                }
            });
        });
    }

    // ============================================
    // MOVIMENTA√á√ïES - CRUD
    // ============================================

    function abrirModalMovimentacao(tipo = 'receita') {
        const modal = new bootstrap.Modal(document.getElementById('modalMovimentacao'));
        const modalTitle = document.getElementById('modalTitle');
        
        modalTitle.textContent = tipo === 'receita' ? 'Nova Receita' : 'Nova Despesa';
        
        document.getElementById('formMovimentacao').reset();
        document.getElementById('movimentacaoId').value = '';
        document.getElementById('tipoMovimentacao').value = tipo;
        
        document.getElementById('tipoReceitaBtn').classList.toggle('active', tipo === 'receita');
        document.getElementById('tipoDespesaBtn').classList.toggle('active', tipo === 'despesa');
        
        document.getElementById('receitaFields').style.display = tipo === 'receita' ? 'block' : 'none';
        document.getElementById('despesaFields').style.display = tipo === 'despesa' ? 'block' : 'none';
        
        const hoje = new Date().toISOString().split('T')[0];
        document.getElementById('dataMovimentacao').value = hoje;
        document.getElementById('vencimento').value = hoje;
        
        modal.show();
    }

    async function salvarMovimentacao() {
        const descricao = document.getElementById('descricao').value.trim();
        const valor = parseFloat(document.getElementById('valor').value);
        const categoriaId = document.getElementById('categoria').value;
        const tipo = document.getElementById('tipoMovimentacao').value;
        const movId = document.getElementById('movimentacaoId').value;
        
        if (!descricao || !valor || !categoriaId) {
            alert('Preencha todos os campos obrigat√≥rios');
            return;
        }
        
        try {
            const movData = {
                tipo: tipo,
                descricao: descricao,
                categoriaId: categoriaId,
                valor: valor,
                status: document.getElementById('status').value,
                data: document.getElementById('dataMovimentacao').value,
                vencimento: document.getElementById('vencimento').value,
                observacoes: document.getElementById('observacoes').value || '',
                profissionalId: currentUser.uid,
                atualizadoEm: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (tipo === 'receita') {
                movData.clienteId = document.getElementById('cliente').value || '';
            } else {
                movData.fornecedor = document.getElementById('fornecedor').value || '';
            }
            
            if (movId) {
                await db.collection("movimentacoes").doc(movId).update(movData);
                const index = movimentacoes.findIndex(m => m.id === movId);
                if (index !== -1) {
                    movimentacoes[index] = { ...movimentacoes[index], ...movData, id: movId };
                }
                alert('Movimenta√ß√£o atualizada!');
            } else {
                movData.criadoEm = firebase.firestore.FieldValue.serverTimestamp();
                const docRef = await db.collection("movimentacoes").add(movData);
                movData.id = docRef.id;
                movimentacoes.unshift(movData);
                alert('Movimenta√ß√£o criada!');
            }
            
            bootstrap.Modal.getInstance(document.getElementById('modalMovimentacao')).hide();
            
            atualizarTabelaMovimentacoes();
            atualizarEstatisticas();
            if (tipoAtualAba === 'categorias') {
                atualizarTabelaCategorias();
            }
            
        } catch (error) {
            alert('Erro ao salvar movimenta√ß√£o');
        }
    }

    async function editarMovimentacao(id) {
        const mov = movimentacoes.find(m => m.id === id);
        if (!mov) return;
        
        abrirModalMovimentacao(mov.tipo);
        document.getElementById('modalTitle').textContent = 'Editar Movimenta√ß√£o';
        document.getElementById('movimentacaoId').value = mov.id;
        document.getElementById('descricao').value = mov.descricao || '';
        document.getElementById('valor').value = mov.valor || 0;
        document.getElementById('status').value = mov.status || 'pendente';
        document.getElementById('dataMovimentacao').value = mov.data || '';
        document.getElementById('vencimento').value = mov.vencimento || '';
        document.getElementById('observacoes').value = mov.observacoes || '';
        document.getElementById('categoria').value = mov.categoriaId || '';
        
        if (mov.tipo === 'receita') {
            document.getElementById('cliente').value = mov.clienteId || '';
        } else {
            document.getElementById('fornecedor').value = mov.fornecedor || '';
        }
    }

    async function excluirMovimentacao(id) {
        if (!confirm('Excluir esta movimenta√ß√£o?')) return;
        
        try {
            await db.collection("movimentacoes").doc(id).delete();
            movimentacoes = movimentacoes.filter(m => m.id !== id);
            
            atualizarTabelaMovimentacoes();
            atualizarEstatisticas();
            if (tipoAtualAba === 'categorias') {
                atualizarTabelaCategorias();
            }
            
            alert('Movimenta√ß√£o exclu√≠da!');
        } catch (error) {
            alert('Erro ao excluir movimenta√ß√£o');
        }
    }

    // ============================================
    // CATEGORIAS - CRUD
    // ============================================

    function abrirModalCategoria(categoriaId = null) {
        const modal = new bootstrap.Modal(document.getElementById('modalCategoria'));
        const btnSalvar = document.getElementById('btnSalvarCategoria');
        
        document.getElementById('formCategoria').reset();
        document.getElementById('corCategoria').value = '#3498db';
        
        if (categoriaId) {
            const categoria = categorias.find(c => c.id === categoriaId);
            if (categoria) {
                document.getElementById('nomeCategoria').value = categoria.nome;
                document.getElementById('tipoCategoria').value = categoria.tipo;
                document.getElementById('corCategoria').value = categoria.cor || '#3498db';
                btnSalvar.textContent = 'Atualizar';
                btnSalvar.onclick = () => salvarCategoria(categoriaId);
            }
        } else {
            btnSalvar.textContent = 'Salvar';
            btnSalvar.onclick = () => salvarCategoria();
        }
        
        modal.show();
    }

    async function salvarCategoria(categoriaId = null) {
        const nome = document.getElementById('nomeCategoria').value.trim();
        const tipo = document.getElementById('tipoCategoria').value;
        const cor = document.getElementById('corCategoria').value;
        
        if (!nome || !tipo) {
            alert('Preencha todos os campos');
            return;
        }
        
        try {
            const categoriaData = {
                nome: nome,
                tipo: tipo,
                cor: cor,
                profissionalId: currentUser.uid,
                atualizadoEm: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (categoriaId) {
                await db.collection("categorias").doc(categoriaId).update(categoriaData);
                const index = categorias.findIndex(c => c.id === categoriaId);
                if (index !== -1) {
                    categorias[index] = { ...categorias[index], ...categoriaData, id: categoriaId };
                }
                alert('Categoria atualizada!');
            } else {
                categoriaData.criadoEm = firebase.firestore.FieldValue.serverTimestamp();
                const docRef = await db.collection("categorias").add(categoriaData);
                categoriaData.id = docRef.id;
                categorias.push(categoriaData);
                alert('Categoria criada!');
            }
            
            bootstrap.Modal.getInstance(document.getElementById('modalCategoria')).hide();
            
            atualizarFiltros();
            if (tipoAtualAba === 'categorias') {
                atualizarTabelaCategorias();
            }
            
        } catch (error) {
            alert('Erro ao salvar categoria');
        }
    }

    async function excluirCategoria(id) {
        const movComCategoria = movimentacoes.find(m => m.categoriaId === id);
        if (movComCategoria) {
            alert('N√£o √© poss√≠vel excluir categoria com movimenta√ß√µes');
            return;
        }
        
        if (!confirm('Excluir esta categoria?')) return;
        
        try {
            await db.collection("categorias").doc(id).delete();
            categorias = categorias.filter(c => c.id !== id);
            
            atualizarFiltros();
            if (tipoAtualAba === 'categorias') {
                atualizarTabelaCategorias();
            }
            
            alert('Categoria exclu√≠da!');
        } catch (error) {
            alert('Erro ao excluir categoria');
        }
    }

    function editarCategoria(id) {
        abrirModalCategoria(id);
    }

    // ============================================
    // ESTAT√çSTICAS
    // ============================================

    function atualizarEstatisticas() {
        const hoje = new Date();
        let totalReceita = 0;
        let totalDespesa = 0;
        let totalAtrasados = 0;
        let totalAReceber = 0;
        let totalAPagar = 0;
        
        movimentacoes.forEach(mov => {
            const valor = mov.valor || 0;
            
            if (mov.tipo === 'receita') {
                totalReceita += valor;
                if (mov.status === 'atrasado') totalAtrasados += valor;
                if ((mov.status === 'pendente' || mov.status === 'atrasado') && mov.vencimento) {
                    const vencimento = new Date(mov.vencimento);
                    const dias = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                    if (dias <= 7 && dias >= 0) totalAReceber += valor;
                }
            } else {
                totalDespesa += valor;
                if (mov.status === 'atrasado') totalAtrasados += valor;
                if ((mov.status === 'pendente' || mov.status === 'atrasado') && mov.vencimento) {
                    const vencimento = new Date(mov.vencimento);
                    const dias = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                    if (dias <= 7 && dias >= 0) totalAPagar += valor;
                }
            }
        });
        
        const saldo = totalReceita - totalDespesa;
        
        document.getElementById('saldoAtual').textContent = formatarMoeda(saldo);
        document.getElementById('receitaMes').textContent = formatarMoeda(totalReceita);
        document.getElementById('despesaMes').textContent = formatarMoeda(totalDespesa);
        document.getElementById('atrasados').textContent = formatarMoeda(totalAtrasados);
        document.getElementById('aReceber').textContent = formatarMoeda(totalAReceber);
        document.getElementById('aPagar').textContent = formatarMoeda(totalAPagar);
    }

    // ============================================
    // GR√ÅFICOS
    // ============================================

    function inicializarGraficos() {
        // Gr√°ficos simples com dados reais
        const receitasUltimosMeses = calcularReceitasUltimosMeses();
        const despesasUltimosMeses = calcularDespesasUltimosMeses();
        const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
        
        // Fluxo de Caixa
        new Chart(document.getElementById('graficoFluxoCaixa'), {
            type: 'line',
            data: {
                labels: meses,
                datasets: [
                    {
                        label: 'Receitas',
                        data: receitasUltimosMeses,
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Despesas',
                        data: despesasUltimosMeses,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
        
        // Distribui√ß√£o de Despesas
        const categoriasDespesas = categorias.filter(c => c.tipo === 'despesa');
        new Chart(document.getElementById('graficoDespesas'), {
            type: 'doughnut',
            data: {
                labels: categoriasDespesas.slice(0, 5).map(c => c.nome),
                datasets: [{
                    data: categoriasDespesas.slice(0, 5).map(c => 
                        movimentacoes
                            .filter(m => m.categoriaId === c.id && m.tipo === 'despesa')
                            .reduce((sum, m) => sum + (m.valor || 0), 0)
                    ),
                    backgroundColor: ['#e74c3c', '#f39c12', '#34495e', '#1abc9c', '#9b59b6']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
        
        // Comparativo
        new Chart(document.getElementById('graficoComparativo'), {
            type: 'bar',
            data: {
                labels: meses,
                datasets: [
                    {
                        label: 'Receitas',
                        data: receitasUltimosMeses,
                        backgroundColor: 'rgba(39, 174, 96, 0.7)'
                    },
                    {
                        label: 'Despesas',
                        data: despesasUltimosMeses,
                        backgroundColor: 'rgba(231, 76, 60, 0.7)'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }

    function calcularReceitasUltimosMeses() {
        const hoje = new Date();
        const meses = [];
        for (let i = 5; i >= 0; i--) {
            const mes = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
            const total = movimentacoes
                .filter(m => m.tipo === 'receita')
                .filter(m => {
                    const dataMov = m.data ? (m.data.toDate ? m.data.toDate() : new Date(m.data)) : null;
                    return dataMov && dataMov.getMonth() === mes.getMonth() && dataMov.getFullYear() === mes.getFullYear();
                })
                .reduce((sum, m) => sum + (m.valor || 0), 0);
            meses.push(total);
        }
        return meses;
    }

    function calcularDespesasUltimosMeses() {
        const hoje = new Date();
        const meses = [];
        for (let i = 5; i >= 0; i--) {
            const mes = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
            const total = movimentacoes
                .filter(m => m.tipo === 'despesa')
                .filter(m => {
                    const dataMov = m.data ? (m.data.toDate ? m.data.toDate() : new Date(m.data)) : null;
                    return dataMov && dataMov.getMonth() === mes.getMonth() && dataMov.getFullYear() === mes.getFullYear();
                })
                .reduce((sum, m) => sum + (m.valor || 0), 0);
            meses.push(total);
        }
        return meses;
    }

    // ============================================
    // EVENT LISTENERS
    // ============================================

    function inicializarEventListeners() {
        // Menu mobile
        document.getElementById('menuToggle').addEventListener('click', () => {
            document.getElementById('dashboardMenu').classList.toggle('show');
        });
        
        // Fechar menu ao clicar fora
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('dashboardMenu');
            const toggle = document.getElementById('menuToggle');
            if (!menu.contains(e.target) && !toggle.contains(e.target)) {
                menu.classList.remove('show');
            }
        });
        
        // Logout
        document.getElementById('btnLogout').addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = 'login.html';
            });
        });
        
        // Bot√µes principais
        document.getElementById('btnNovaReceita').addEventListener('click', () => abrirModalMovimentacao('receita'));
        document.getElementById('btnNovaDespesa').addEventListener('click', () => abrirModalMovimentacao('despesa'));
        document.getElementById('btnNovaCategoria').addEventListener('click', () => abrirModalCategoria());
        document.getElementById('btnExportar').addEventListener('click', exportarRelatorio);
        document.getElementById('btnAplicarFiltros').addEventListener('click', atualizarTabelaMovimentacoes);
        
        // Bot√µes tipo movimenta√ß√£o
        document.getElementById('tipoReceitaBtn').addEventListener('click', function() {
            document.querySelectorAll('.tipo-mov-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('tipoMovimentacao').value = 'receita';
            document.getElementById('receitaFields').style.display = 'block';
            document.getElementById('despesaFields').style.display = 'none';
        });
        
        document.getElementById('tipoDespesaBtn').addEventListener('click', function() {
            document.querySelectorAll('.tipo-mov-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('tipoMovimentacao').value = 'despesa';
            document.getElementById('receitaFields').style.display = 'none';
            document.getElementById('despesaFields').style.display = 'block';
        });
        
        // Salvar movimenta√ß√£o
        document.getElementById('btnSalvarMovimentacao').addEventListener('click', salvarMovimentacao);
        
        // Salvar categoria
        document.getElementById('btnSalvarCategoria').addEventListener('click', () => salvarCategoria());
        
        // Filtros em tempo real
        ['searchMovimentacoes', 'filterTipo', 'filterStatus', 'filterCategoria'].forEach(id => {
            document.getElementById(id).addEventListener('input', atualizarTabelaMovimentacoes);
        });
        
        // Relat√≥rios
        document.getElementById('btnRelatorioCompleto').addEventListener('click', () => exportarPDF(true));
        document.getElementById('btnRelatorioSimples').addEventListener('click', () => exportarPDF(false));
    }

    // ============================================
    // EXPORTA√á√ÉO
    // ============================================

    function exportarPDF(detalhado = false) {
        alert(detalhado ? 'Relat√≥rio detalhado gerado!' : 'Relat√≥rio resumido gerado!');
    }

    function exportarRelatorio() {
        alert('Relat√≥rio exportado!');
    }

    // ============================================
    // INICIALIZA√á√ÉO FINAL
    // ============================================

    document.addEventListener('DOMContentLoaded', inicializarEventListeners);
    </script>
</body>
</html>