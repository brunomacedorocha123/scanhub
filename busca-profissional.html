<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Profissionais - ScanHub</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #44689a;
            --secondary-color: #FF6B35;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.1);
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f8f9fa;
            color: #333;
            padding-top: 80px;
        }

        /* Navbar */
        .navbar {
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .navbar-brand img {
            height: 60px;
            transform: scale(2);
            transform-origin: left center;
        }

        /* Header Busca */
        .header-busca {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }

        .search-box {
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
            z-index: 10;
        }

        .search-box input {
            padding-left: 50px;
            height: 56px;
            border-radius: 12px;
            border: 2px solid var(--gray-200);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-box input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(68, 104, 154, 0.1);
        }

        /* Filtros */
        .filtros-container {
            background: var(--gray-100);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid var(--gray-200);
        }

        /* Grid de Profissionais */
        .profissionais-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (min-width: 768px) {
            .profissionais-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 992px) {
            .profissionais-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1200px) {
            .profissionais-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Card do Profissional */
        .profissional-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            border: 1px solid var(--gray-200);
            height: 100%;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .profissional-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-avatar {
            width: 100%;
            height: 180px;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .card-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-content {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            margin-bottom: 12px;
        }

        .card-categoria {
            background: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 8px;
        }

        .card-nome {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-cidade {
            color: var(--gray-600);
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .card-descricao {
            color: #555;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .card-estrelas {
            color: #FFD700;
            font-size: 0.9rem;
        }

        .card-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .card-btn:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        /* Modal do Profissional */
        .modal-profissional .modal-dialog {
            max-width: 900px;
        }

        .modal-profissional .modal-content {
            border-radius: 20px;
            overflow: hidden;
            border: none;
        }

        .modal-header-profissional {
            background: linear-gradient(135deg, var(--primary-color) 0%, #5a82c2 100%);
            color: white;
            padding: 30px;
            position: relative;
            border: none;
        }

        .modal-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 5px solid white;
            overflow: hidden;
            margin-bottom: 20px;
            background: var(--gray-100);
        }

        .modal-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-profissional .btn-close {
            filter: brightness(0) invert(1);
            opacity: 0.8;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .modal-profissional .btn-close:hover {
            opacity: 1;
        }

        /* Abas do Modal */
        .modal-tabs {
            display: flex;
            border-bottom: 2px solid var(--gray-200);
            background: white;
            padding: 0 30px;
        }

        .modal-tab {
            padding: 15px 20px;
            background: none;
            border: none;
            font-weight: 500;
            color: var(--gray-600);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .modal-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .modal-tab-badge {
            background: var(--gray-200);
            color: var(--gray-600);
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .modal-tab.active .modal-tab-badge {
            background: var(--primary-color);
            color: white;
        }

        .modal-body-profissional {
            padding: 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Conte√∫do das Abas */
        .tab-content {
            padding: 30px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Se√ß√£o Sobre */
        .secao-titulo {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gray-200);
        }

        .info-item {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .info-item i {
            color: var(--primary-color);
            margin-right: 10px;
            margin-top: 3px;
            width: 20px;
        }

        .info-label {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .info-value {
            color: #555;
            line-height: 1.5;
        }

        /* Tags */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .tag {
            background: var(--gray-100);
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Galeria */
        .galeria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .galeria-item {
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1;
            background: var(--gray-100);
        }

        .galeria-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .galeria-item:hover img {
            transform: scale(1.05);
        }

        /* Cat√°logo */
        .catalogo-item {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .catalogo-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .catalogo-tipo {
            background: var(--gray-100);
            color: var(--gray-600);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .catalogo-preco {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        /* Bot√µes A√ß√£o */
        .botoes-acao {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            transition: all 0.3s;
        }

        .btn-whatsapp:hover {
            background: #128C7E;
            color: white;
            transform: translateY(-2px);
        }

        .btn-interesse {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            transition: all 0.3s;
        }

        .btn-interesse:hover {
            background: #365a8a;
            transform: translateY(-2px);
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-600);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--gray-300);
            margin-bottom: 20px;
        }

        .empty-state h4 {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--gray-700);
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsivo */
        @media (max-width: 768px) {
            body {
                padding-top: 70px;
            }
            
            .header-busca {
                padding: 20px;
            }
            
            .modal-profissional .modal-dialog {
                margin: 10px;
            }
            
            .modal-header-profissional {
                padding: 20px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .botoes-acao {
                flex-direction: column;
            }
            
            .btn-whatsapp, .btn-interesse {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="dashboard-cliente.html">
                <img src="logoscanhub.png" alt="ScanHub">
            </a>
            <div class="d-flex align-items-center">
                <a href="dashboard-cliente.html" class="btn btn-outline-primary me-2">
                    <i class="fas fa-arrow-left me-2"></i>Voltar
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container py-4">
        <!-- Header com Busca -->
        <div class="header-busca">
            <h1 class="mb-4">Encontre o profissional ideal</h1>
            
            <div class="row g-3">
                <div class="col-md-8">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control" id="inputBusca" 
                               placeholder="O que voc√™ precisa? Ex: encanador, eletricista, designer...">
                    </div>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="selectEspecialidade">
                        <option value="">Todas especialidades</option>
                        <!-- Ser√° preenchido via JavaScript -->
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="text" class="form-control" id="inputCidade" placeholder="Cidade">
                </div>
            </div>
        </div>

        <!-- Filtros R√°pidos -->
        <div class="filtros-container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h6 class="mb-0" id="contadorResultados">Carregando profissionais...</h6>
                </div>
                <div class="col-md-6 text-end">
                    <select class="form-select form-select-sm w-auto d-inline-block" id="selectOrdenar">
                        <option value="relevancia">Mais relevantes</option>
                        <option value="nome">Nome A-Z</option>
                        <option value="cidade">Cidade</option>
                        <option value="avaliacao">Melhor avaliados</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Grid de Profissionais -->
        <div class="profissionais-grid" id="profissionaisGrid">
            <!-- Cards ser√£o inseridos aqui via JavaScript -->
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <h4>Buscando profissionais...</h4>
                <p>Carregando lista de profissionais dispon√≠veis</p>
            </div>
        </div>

        <!-- Pagina√ß√£o -->
        <nav id="paginacao" style="display: none;">
            <ul class="pagination justify-content-center">
                <!-- Pagina√ß√£o ser√° gerada via JavaScript -->
            </ul>
        </nav>
    </div>

    <!-- Modal Profissional -->
    <div class="modal fade modal-profissional" id="modalProfissional" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <!-- Header com foto e informa√ß√µes b√°sicas -->
                <div class="modal-header-profissional">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    
                    <div class="text-center">
                        <div class="modal-avatar mx-auto" id="modalAvatar">
                            <i class="fas fa-user fa-3x text-muted" style="line-height: 110px;"></i>
                        </div>
                        <h3 id="modalNome">Nome do Profissional</h3>
                        <p id="modalSlogan" class="mb-2">Slogan do profissional</p>
                        <div class="d-flex justify-content-center align-items-center gap-3">
                            <span id="modalEspecialidade" class="badge bg-light text-dark">Especialidade</span>
                            <span id="modalCidade" class="text-light"><i class="fas fa-map-marker-alt"></i> Cidade</span>
                        </div>
                    </div>
                </div>

                <!-- Abas -->
                <div class="modal-tabs">
                    <button class="modal-tab active" data-tab="sobre">
                        <i class="fas fa-user me-2"></i>Sobre
                    </button>
                    <button class="modal-tab" data-tab="catalogo">
                        <i class="fas fa-boxes me-2"></i>Cat√°logo
                        <span class="modal-tab-badge" id="badgeCatalogo">0</span>
                    </button>
                    <button class="modal-tab" data-tab="portfolio">
                        <i class="fas fa-images me-2"></i>Portf√≥lio
                        <span class="modal-tab-badge" id="badgePortfolio">0</span>
                    </button>
                    <button class="modal-tab" data-tab="contato">
                        <i class="fas fa-address-book me-2"></i>Contato
                    </button>
                </div>

                <!-- Conte√∫do das Abas -->
                <div class="modal-body-profissional">
                    <!-- ABA: SOBRE -->
                    <div class="tab-content">
                        <div class="tab-pane active" id="tabSobre">
                            <!-- Descri√ß√£o -->
                            <div class="mb-4">
                                <h6 class="secao-titulo">Descri√ß√£o</h6>
                                <p id="modalDescricao" class="info-value">Carregando...</p>
                            </div>

                            <!-- Informa√ß√µes Profissionais -->
                            <div class="mb-4">
                                <h6 class="secao-titulo">Informa√ß√µes Profissionais</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-briefcase"></i>
                                            <div>
                                                <div class="info-label">Especialidade Principal</div>
                                                <div class="info-value" id="infoEspecialidade">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-calendar-alt"></i>
                                            <div>
                                                <div class="info-label">Experi√™ncia</div>
                                                <div class="info-value" id="infoExperiencia">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-tags"></i>
                                            <div>
                                                <div class="info-label">Sub-especialidades</div>
                                                <div class="tags-container" id="infoTags">
                                                    <!-- Tags ser√£o inseridas aqui -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- √Årea de Atendimento -->
                            <div class="mb-4">
                                <h6 class="secao-titulo">√Årea de Atendimento</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <div>
                                                <div class="info-label">Cidade Base</div>
                                                <div class="info-value" id="infoCidadeBase">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-ruler"></i>
                                            <div>
                                                <div class="info-label">Raio de Atendimento</div>
                                                <div class="info-value" id="infoRaioKm">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="info-item">
                                            <i class="fas fa-map-pin"></i>
                                            <div>
                                                <div class="info-label">Cidades Atendidas</div>
                                                <div class="tags-container" id="infoCidadesAtendidas">
                                                    <!-- Cidades ser√£o inseridas aqui -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-home"></i>
                                            <div>
                                                <div class="info-label" id="infoAtendeDomicilio">Atende em domic√≠lio: -</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-laptop"></i>
                                            <div>
                                                <div class="info-label" id="infoAtendeOnline">Atende online: -</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Formas de Trabalho -->
                            <div class="mb-4">
                                <h6 class="secao-titulo">Formas de Trabalho</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-money-bill-wave"></i>
                                            <div>
                                                <div class="info-label">Formas de Pagamento</div>
                                                <div class="tags-container" id="infoFormasPagamento">
                                                    <!-- Formas de pagamento ser√£o inseridas aqui -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-clock"></i>
                                            <div>
                                                <div class="info-label">Tempo de Resposta</div>
                                                <div class="info-value" id="infoTempoResposta">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-file-invoice-dollar"></i>
                                            <div>
                                                <div class="info-label" id="infoOrcamentoGratuito">Or√ßamento gratuito: -</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-shield-alt"></i>
                                            <div>
                                                <div class="info-label">Garantia Oferecida</div>
                                                <div class="info-value" id="infoGarantia">-</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ABA: CAT√ÅLOGO -->
                        <div class="tab-pane" id="tabCatalogo">
                            <h6 class="secao-titulo">Servi√ßos & Produtos</h6>
                            <div id="catalogoContainer">
                                <p class="text-muted">Carregando cat√°logo...</p>
                            </div>
                        </div>

                        <!-- ABA: PORTF√ìLIO -->
                        <div class="tab-pane" id="tabPortfolio">
                            <h6 class="secao-titulo">Portf√≥lio - Trabalhos Realizados</h6>
                            <div id="portfolioContainer">
                                <p class="text-muted">Carregando portf√≥lio...</p>
                            </div>
                        </div>

                        <!-- ABA: CONTATO -->
                        <div class="tab-pane" id="tabContato">
                            <h6 class="secao-titulo">Informa√ß√µes de Contato</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="info-item">
                                        <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                                        <div>
                                            <div class="info-label">WhatsApp</div>
                                            <div class="info-value" id="infoWhatsapp">-</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-item">
                                        <i class="fas fa-envelope"></i>
                                        <div>
                                            <div class="info-label">E-mail Profissional</div>
                                            <div class="info-value" id="infoEmail">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <h6 class="secao-titulo">Links</h6>
                                <div id="infoLinks">
                                    <p class="text-muted">Nenhum link dispon√≠vel</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div class="botoes-acao">
                        <button class="btn-whatsapp" id="btnWhatsappModal">
                            <i class="fab fa-whatsapp"></i>
                            Conversar no WhatsApp
                        </button>
                        <button class="btn-interesse" id="btnInteresseModal">
                            <i class="fas fa-handshake"></i>
                            Tenho Interesse
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
   <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { 
    getFirestore, 
    collection, 
    getDocs,
    query,
    where,
    orderBy
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyAYqWTg2RAr4IbqxRsl58TZGQ9tKnyFK14",
    authDomain: "scanhub-ed512.firebaseapp.com",
    projectId: "scanhub-ed512",
    storageBucket: "scanhub-ed512.firebasestorage.app",
    messagingSenderId: "1083305018831",
    appId: "1:1083305018831:web:f7594d560439c8965c3eba"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Elementos DOM
const loadingOverlay = document.getElementById('loadingOverlay');
const inputBusca = document.getElementById('inputBusca');
const selectEspecialidade = document.getElementById('selectEspecialidade');
const inputCidade = document.getElementById('inputCidade');
const selectOrdenar = document.getElementById('selectOrdenar');
const contadorResultados = document.getElementById('contadorResultados');
const profissionaisGrid = document.getElementById('profissionaisGrid');

// Modal elements
const modalProfissionalElement = document.getElementById('modalProfissional');
const modalProfissional = modalProfissionalElement ? new bootstrap.Modal(modalProfissionalElement) : null;
const modalAvatar = document.getElementById('modalAvatar');
const modalNome = document.getElementById('modalNome');
const modalSlogan = document.getElementById('modalSlogan');
const modalEspecialidade = document.getElementById('modalEspecialidade');
const modalCidade = document.getElementById('modalCidade');
const modalDescricao = document.getElementById('modalDescricao');
const btnWhatsappModal = document.getElementById('btnWhatsappModal');
const btnInteresseModal = document.getElementById('btnInteresseModal');

// Info elements
const infoEspecialidade = document.getElementById('infoEspecialidade');
const infoExperiencia = document.getElementById('infoExperiencia');
const infoTags = document.getElementById('infoTags');
const infoCidadeBase = document.getElementById('infoCidadeBase');
const infoRaioKm = document.getElementById('infoRaioKm');
const infoCidadesAtendidas = document.getElementById('infoCidadesAtendidas');
const infoAtendeDomicilio = document.getElementById('infoAtendeDomicilio');
const infoAtendeOnline = document.getElementById('infoAtendeOnline');
const infoFormasPagamento = document.getElementById('infoFormasPagamento');
const infoTempoResposta = document.getElementById('infoTempoResposta');
const infoOrcamentoGratuito = document.getElementById('infoOrcamentoGratuito');
const infoGarantia = document.getElementById('infoGarantia');
const infoWhatsapp = document.getElementById('infoWhatsapp');
const infoEmail = document.getElementById('infoEmail');
const infoLinks = document.getElementById('infoLinks');

// Tab elements
const modalTabs = document.querySelectorAll('.modal-tab');
const badgeCatalogo = document.getElementById('badgeCatalogo');
const badgePortfolio = document.getElementById('badgePortfolio');
const tabPanes = document.querySelectorAll('.tab-pane');
const catalogoContainer = document.getElementById('catalogoContainer');
const portfolioContainer = document.getElementById('portfolioContainer');

// Vari√°veis globais
let todosProfissionais = [];
let profissionaisFiltrados = [];
let especialidadesUnicas = new Set();
let profissionalAtual = null;

// Especialidades do sistema (copiadas do seu HTML)
const especialidadesSistema = [
    "advocacia", "alarme", "alvenaria", "antena", "ar_condicionado", "arquitetura", "artes_marciais",
    "babysitter", "barbeiro", "cabeleireiro", "calhas", "cerca_eletrica", "ceramica", "chaveiro",
    "coach", "consultoria", "construcao", "contabilidade", "costura", "cuidador", "danca", "dedetizacao",
    "design", "design_interiores", "eletrica", "eletrodomesticos", "eletronica", "encanador", "engenharia",
    "entregador", "eventos", "festas", "fotografo", "forro", "funilaria", "gesso", "guias_turismo",
    "hidraulica", "impermeabilizacao", "jardineiro", "jardinagem", "jato_areia", "lavanderia", "limpeza",
    "logistica", "manicure", "marcenaria", "marketing_digital", "massoterapia", "mecanica", "montador",
    "motorista", "musico", "nutricionista", "organizacao", "personal_trainer", "pet_sitter", "pintura",
    "piso", "piscina", "portao", "programador", "professor", "psicologia", "rede", "redator", "reforma",
    "seguranca", "serralheria", "sistema_fotovoltaico", "social_media", "solda", "som", "tecnico_celular",
    "telhado", "ti", "traducao", "turismo", "veterinaria", "video_maker", "vidracaria", "web_designer",
    "yoga", "outro"
];

// Fun√ß√£o para formatar especialidade (remove underscore, capitaliza)
function formatarEspecialidade(especialidade) {
    if (!especialidade) return 'Profissional';
    let formatted = especialidade.replace(/_/g, ' ');
    return formatted.charAt(0).toUpperCase() + formatted.slice(1);
}

// FUN√á√ÉO PRINCIPAL DE INICIALIZA√á√ÉO
async function init() {
    console.log('üöÄ Inicializando sistema de busca...');
    showLoading();
    
    try {
        await carregarProfissionais();
        console.log(`‚úÖ ${todosProfissionais.length} profissionais carregados`);
        
        preencherFiltroEspecialidades();
        aplicarFiltros();
        inicializarEventListeners();
        inicializarAbasModal();
        
        console.log('‚úÖ Sistema pronto!');
    } catch (error) {
        console.error('‚ùå Erro na inicializa√ß√£o:', error);
        mostrarErro('Erro ao carregar profissionais. Tente recarregar a p√°gina.');
    } finally {
        hideLoading();
    }
}

// Mostrar loading
function showLoading() {
    if (loadingOverlay) loadingOverlay.style.display = 'flex';
}

// Esconder loading
function hideLoading() {
    if (loadingOverlay) loadingOverlay.style.display = 'none';
}

// CARREGAR PROFISSIONAIS DO FIRESTORE
async function carregarProfissionais() {
    console.log('üì• Buscando profissionais no Firestore...');
    
    try {
        const usuariosRef = collection(db, "usuarios");
        const q = query(
            usuariosRef,
            where("tipoUsuario", "==", "profissional"),
            where("status", "==", "ativo")
        );
        
        const querySnapshot = await getDocs(q);
        todosProfissionais = [];
        especialidadesUnicas.clear();
        
        console.log(`üìä ${querySnapshot.size} documentos encontrados`);
        
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            // VERIFICA√á√ÉO CR√çTICA: S√≥ incluir se tiver perfil completo
            if (data.profissional && data.profissional.perfilCompleto === true) {
                const profissional = {
                    id: doc.id,
                    ...data,
                    profissional: data.profissional || {}
                };
                
                todosProfissionais.push(profissional);
                
                // Adicionar especialidade ao filtro
                if (profissional.profissional.especialidadePrincipal) {
                    especialidadesUnicas.add(profissional.profissional.especialidadePrincipal);
                }
                
                console.log(`üë§ ${profissional.profissional.nomeProfissional || profissional.apelido} - ${profissional.profissional.especialidadePrincipal}`);
            } else {
                console.log(`‚ùå ${doc.id} - Perfil incompleto ou n√£o vis√≠vel`);
            }
        });
        
        console.log(`‚úÖ ${todosProfissionais.length} profissionais v√°lidos carregados`);
        
    } catch (error) {
        console.error('‚ùå ERRO Firestore:', error);
        throw error;
    }
}

// PREENCHER FILTRO DE ESPECIALIDADES
function preencherFiltroEspecialidades() {
    if (!selectEspecialidade) return;
    
    // Limpar select
    selectEspecialidade.innerHTML = '<option value="">Todas especialidades</option>';
    
    console.log(`üìã ${especialidadesUnicas.size} especialidades √∫nicas encontradas:`, Array.from(especialidadesUnicas));
    
    // Criar array ordenado de especialidades
    const especialidadesOrdenadas = Array.from(especialidadesUnicas).sort();
    
    // Adicionar cada especialidade
    especialidadesOrdenadas.forEach(especialidade => {
        const option = document.createElement('option');
        option.value = especialidade;
        option.textContent = formatarEspecialidade(especialidade);
        selectEspecialidade.appendChild(option);
    });
    
    console.log('‚úÖ Filtro de especialidades preenchido');
}

// APLICAR FILTROS
function aplicarFiltros() {
    console.log('üîç Aplicando filtros...');
    
    // Pegar valores dos filtros
    const buscaTexto = inputBusca ? inputBusca.value.toLowerCase().trim() : '';
    const especialidadeFiltro = selectEspecialidade ? selectEspecialidade.value : '';
    const cidadeFiltro = inputCidade ? inputCidade.value.toLowerCase().trim() : '';
    const ordenarPor = selectOrdenar ? selectOrdenar.value : 'relevancia';
    
    console.log('Filtros ativos:', {
        texto: buscaTexto,
        especialidade: especialidadeFiltro,
        cidade: cidadeFiltro,
        ordenar: ordenarPor
    });
    
    // Aplicar filtros
    profissionaisFiltrados = todosProfissionais.filter(prof => {
        const profData = prof.profissional;
        
        // 1. FILTRO POR TEXTO
        let matchTexto = true;
        if (buscaTexto) {
            const buscaLower = buscaTexto.toLowerCase();
            matchTexto = 
                (profData.nomeProfissional && profData.nomeProfissional.toLowerCase().includes(buscaLower)) ||
                (profData.descricao && profData.descricao.toLowerCase().includes(buscaLower)) ||
                (profData.slogan && profData.slogan.toLowerCase().includes(buscaLower)) ||
                (profData.especialidadePrincipal && profData.especialidadePrincipal.toLowerCase().includes(buscaLower)) ||
                (prof.apelido && prof.apelido.toLowerCase().includes(buscaLower));
        }
        
        // 2. FILTRO POR ESPECIALIDADE
        let matchEspecialidade = true;
        if (especialidadeFiltro) {
            matchEspecialidade = profData.especialidadePrincipal === especialidadeFiltro;
        }
        
        // 3. FILTRO POR CIDADE
        let matchCidade = true;
        if (cidadeFiltro) {
            const cidadeLower = cidadeFiltro.toLowerCase();
            matchCidade = 
                (profData.cidadeBase && profData.cidadeBase.toLowerCase().includes(cidadeLower)) ||
                (profData.cidadesAtendidas && 
                 Array.isArray(profData.cidadesAtendidas) &&
                 profData.cidadesAtendidas.some(cidade => 
                     cidade && cidade.toLowerCase().includes(cidadeLower)
                 ));
        }
        
        return matchTexto && matchEspecialidade && matchCidade;
    });
    
    console.log(`üìä Resultados: ${profissionaisFiltrados.length} de ${todosProfissionais.length}`);
    
    // ORDENAR RESULTADOS
    ordenarResultados(ordenarPor);
    
    // ATUALIZAR INTERFACE
    atualizarContadorResultados();
    renderizarProfissionais();
}

// ORDENAR RESULTADOS
function ordenarResultados(criterio) {
    switch(criterio) {
        case 'nome':
            profissionaisFiltrados.sort((a, b) => {
                const nomeA = a.profissional.nomeProfissional || '';
                const nomeB = b.profissional.nomeProfissional || '';
                return nomeA.localeCompare(nomeB);
            });
            break;
            
        case 'cidade':
            profissionaisFiltrados.sort((a, b) => {
                const cidadeA = a.profissional.cidadeBase || '';
                const cidadeB = b.profissional.cidadeBase || '';
                return cidadeA.localeCompare(cidadeB);
            });
            break;
            
        case 'avaliacao':
            // TODO: Implementar avalia√ß√µes
            break;
            
        default: // relevancia
            break;
    }
}

// ATUALIZAR CONTADOR
function atualizarContadorResultados() {
    if (!contadorResultados) return;
    
    const total = profissionaisFiltrados.length;
    if (total === 0) {
        contadorResultados.textContent = 'Nenhum profissional encontrado';
    } else if (total === 1) {
        contadorResultados.textContent = '1 profissional encontrado';
    } else {
        contadorResultados.textContent = `${total} profissionais encontrados`;
    }
}

// RENDERIZAR PROFISSIONAIS
function renderizarProfissionais() {
    if (!profissionaisGrid) return;
    
    profissionaisGrid.innerHTML = '';
    
    if (profissionaisFiltrados.length === 0) {
        profissionaisGrid.innerHTML = `
            <div class="col-12">
                <div class="alert alert-info text-center">
                    <i class="fas fa-search fa-2x mb-3"></i>
                    <h4>Nenhum profissional encontrado</h4>
                    <p>Tente ajustar os filtros de busca</p>
                </div>
            </div>
        `;
        return;
    }
    
    profissionaisFiltrados.forEach(prof => {
        const card = criarCardProfissional(prof);
        if (card) profissionaisGrid.appendChild(card);
    });
}

// CRIAR CARD DO PROFISSIONAL
function criarCardProfissional(prof) {
    const profData = prof.profissional;
    const card = document.createElement('div');
    card.className = 'profissional-card';
    card.dataset.id = prof.id;
    
    // Foto
    const foto = prof.fotoPerfilProfissional || prof.fotoPerfil || '';
    const fotoHtml = foto 
        ? `<img src="${foto}" alt="${profData.nomeProfissional || 'Profissional'}" 
             onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgZmlsbD0iI2U5ZWNlZiIvPjx0ZXh0IHg9IjYwIiB5PSI2MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5IiBkeT0iLjNlbSI+PC90ZXh0Pjwvc3ZnPg==';">`
        : '<i class="fas fa-user fa-3x text-muted" style="line-height: 180px;"></i>';
    
    // Descri√ß√£o
    const descricao = profData.descricao || '';
    const descricaoCurta = descricao.length > 100 ? descricao.substring(0, 100) + '...' : descricao;
    
    // Cidade
    const cidade = profData.cidadeBase || 'Local n√£o informado';
    
    // Especialidade formatada
    const especialidadeFormatada = formatarEspecialidade(profData.especialidadePrincipal);
    
    card.innerHTML = `
        <div class="card-avatar">
            ${fotoHtml}
        </div>
        <div class="card-content">
            <div class="card-header">
                <span class="card-categoria">${especialidadeFormatada}</span>
                <h4 class="card-nome">${profData.nomeProfissional || prof.apelido || 'Profissional'}</h4>
                <p class="card-cidade"><i class="fas fa-map-marker-alt"></i> ${cidade}</p>
            </div>
            <p class="card-descricao">${descricaoCurta || 'Sem descri√ß√£o'}</p>
            <div class="card-footer">
                <div class="card-estrelas">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                    <small class="text-muted">(4.5)</small>
                </div>
                <button class="card-btn btn-ver-perfil">
                    Ver Perfil
                </button>
            </div>
        </div>
    `;
    
    // Evento do bot√£o
    const btnVerPerfil = card.querySelector('.btn-ver-perfil');
    if (btnVerPerfil) {
        btnVerPerfil.addEventListener('click', (e) => {
            e.stopPropagation();
            abrirModalProfissional(prof);
        });
    }
    
    // Evento do card todo
    card.addEventListener('click', (e) => {
        if (!e.target.closest('.btn-ver-perfil')) {
            abrirModalProfissional(prof);
        }
    });
    
    return card;
}

// ABRIR MODAL DO PROFISSIONAL
async function abrirModalProfissional(prof) {
    if (!modalProfissional) {
        alert('Modal n√£o encontrado');
        return;
    }
    
    profissionalAtual = prof;
    const profData = prof.profissional;
    
    showLoading();
    
    try {
        // PREENCHER INFORMA√á√ïES B√ÅSICAS
        const foto = prof.fotoPerfilProfissional || prof.fotoPerfil || '';
        if (modalAvatar) {
            modalAvatar.innerHTML = foto 
                ? `<img src="${foto}" alt="${profData.nomeProfissional}" 
                     onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-user fa-3x text-muted\\' style=\\'line-height: 110px;\\'></i>';">`
                : '<i class="fas fa-user fa-3x text-muted" style="line-height: 110px;"></i>';
        }
        
        if (modalNome) modalNome.textContent = profData.nomeProfissional || prof.apelido || 'Profissional';
        if (modalSlogan) modalSlogan.textContent = profData.slogan || '';
        if (modalEspecialidade) modalEspecialidade.textContent = formatarEspecialidade(profData.especialidadePrincipal);
        if (modalCidade) modalCidade.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${profData.cidadeBase || ''}`;
        if (modalDescricao) modalDescricao.textContent = profData.descricao || 'Sem descri√ß√£o';
        
        // PREENCHER INFORMA√á√ïES DETALHADAS
        if (infoEspecialidade) infoEspecialidade.textContent = formatarEspecialidade(profData.especialidadePrincipal);
        if (infoExperiencia) infoExperiencia.textContent = formatarExperiencia(profData.anosExperiencia);
        if (infoCidadeBase) infoCidadeBase.textContent = profData.cidadeBase || '-';
        if (infoRaioKm) infoRaioKm.textContent = profData.raioKm ? `${profData.raioKm} km` : '-';
        if (infoTempoResposta) infoTempoResposta.textContent = formatarTempoResposta(profData.tempoResposta);
        if (infoOrcamentoGratuito) infoOrcamentoGratuito.textContent = `Or√ßamento gratuito: ${profData.orcamentoGratuito ? 'Sim' : 'N√£o'}`;
        if (infoGarantia) infoGarantia.textContent = profData.garantiaDias ? `${profData.garantiaDias} dias` : '-';
        if (infoAtendeDomicilio) infoAtendeDomicilio.textContent = `Atende em domic√≠lio: ${profData.atendeDomicilio ? 'Sim' : 'N√£o'}`;
        if (infoAtendeOnline) infoAtendeOnline.textContent = `Atende online: ${profData.atendeOnline ? 'Sim' : 'N√£o'}`;
        
        // WHATSAPP
        const whatsapp = profData.whatsapp || prof.celular || '';
        if (infoWhatsapp) infoWhatsapp.textContent = whatsapp || 'N√£o informado';
        if (btnWhatsappModal) {
            if (whatsapp) {
                btnWhatsappModal.style.display = 'flex';
                btnWhatsappModal.onclick = () => abrirWhatsApp(whatsapp, prof);
            } else {
                btnWhatsappModal.style.display = 'none';
            }
        }
        
        // EMAIL
        if (infoEmail) infoEmail.textContent = profData.emailProfissional || prof.email || 'N√£o informado';
        
        // TAGS
        if (infoTags) preencherTags(infoTags, profData.especialidades);
        if (infoCidadesAtendidas) preencherTags(infoCidadesAtendidas, profData.cidadesAtendidas);
        if (infoFormasPagamento) preencherTags(infoFormasPagamento, profData.formasPagamento);
        
        // LINKS
        if (infoLinks) {
            if (profData.links && profData.links.length > 0 && profData.links[0]) {
                infoLinks.innerHTML = profData.links.map(link => 
                    `<a href="${link}" target="_blank" class="d-block mb-2 text-decoration-none">
                        <i class="fas fa-external-link-alt me-2"></i>${link}
                    </a>`
                ).join('');
            } else {
                infoLinks.innerHTML = '<p class="text-muted">Nenhum link dispon√≠vel</p>';
            }
        }
        
        // CARREGAR CAT√ÅLOGO E PORTF√ìLIO
        await Promise.all([
            carregarCatalogoProfissional(prof.id),
            carregarPortfolioProfissional(profData)
        ]);
        
        // ATUALIZAR BADGES
        atualizarBadges();
        
        // ABRIR MODAL
        modalProfissional.show();
        
    } catch (error) {
        console.error('Erro ao abrir modal:', error);
        alert('Erro ao carregar detalhes do profissional');
    } finally {
        hideLoading();
    }
}

// CARREGAR CAT√ÅLOGO
async function carregarCatalogoProfissional(profissionalId) {
    if (!catalogoContainer) return;
    
    try {
        // Buscar servi√ßos
        const servicosRef = collection(db, "servicos");
        const qServicos = query(
            servicosRef,
            where("profissionalId", "==", profissionalId),
            where("status", "==", "ativo")
        );
        
        const servicosSnapshot = await getDocs(qServicos);
        const servicos = [];
        servicosSnapshot.forEach(doc => servicos.push({ id: doc.id, ...doc.data() }));
        
        // Buscar produtos
        const produtosRef = collection(db, "produtos");
        const qProdutos = query(
            produtosRef,
            where("profissionalId", "==", profissionalId),
            where("status", "==", "ativo")
        );
        
        const produtosSnapshot = await getDocs(qProdutos);
        const produtos = [];
        produtosSnapshot.forEach(doc => produtos.push({ id: doc.id, ...doc.data() }));
        
        // Renderizar
        renderizarCatalogo(servicos, produtos);
        
    } catch (error) {
        console.error('Erro cat√°logo:', error);
        catalogoContainer.innerHTML = '<p class="text-muted">Erro ao carregar cat√°logo</p>';
    }
}

// RENDERIZAR CAT√ÅLOGO
function renderizarCatalogo(servicos, produtos) {
    if (!catalogoContainer) return;
    
    const totalItens = servicos.length + produtos.length;
    
    if (totalItens === 0) {
        catalogoContainer.innerHTML = '<p class="text-muted">Nenhum item no cat√°logo</p>';
        return;
    }
    
    let html = '';
    
    // Servi√ßos
    servicos.forEach(servico => {
        html += `
            <div class="catalogo-item">
                <div class="catalogo-item-header">
                    <div>
                        <h6 class="mb-1">${servico.nome || 'Servi√ßo'}</h6>
                        <span class="catalogo-tipo">Servi√ßo</span>
                    </div>
                    <div class="catalogo-preco">${formatarPreco(servico.precoVenda)}</div>
                </div>
                <p class="mb-2">${servico.descricao || 'Sem descri√ß√£o'}</p>
                ${servico.duracao ? `<small class="text-muted"><i class="far fa-clock"></i> ${servico.duracao}</small>` : ''}
            </div>
        `;
    });
    
    // Produtos
    produtos.forEach(produto => {
        const estoque = produto.estoqueAtual > 0 
            ? `<span class="badge bg-success ms-2">${produto.estoqueAtual} em estoque</span>`
            : `<span class="badge bg-danger ms-2">Esgotado</span>`;
        
        html += `
            <div class="catalogo-item">
                <div class="catalogo-item-header">
                    <div>
                        <h6 class="mb-1">${produto.nome || 'Produto'}</h6>
                        <span class="catalogo-tipo">Produto</span>
                        ${estoque}
                    </div>
                    <div class="catalogo-preco">${formatarPreco(produto.precoVenda)}</div>
                </div>
                <p class="mb-2">${produto.descricao || 'Sem descri√ß√£o'}</p>
                ${produto.marca ? `<small class="text-muted"><i class="fas fa-tag"></i> ${produto.marca}</small>` : ''}
            </div>
        `;
    });
    
    catalogoContainer.innerHTML = html;
}

// CARREGAR PORTF√ìLIO
async function carregarPortfolioProfissional(profData) {
    if (!portfolioContainer) return;
    
    const fotos = profData.portfolioFotos || [];
    const videos = profData.videos || [];
    
    if (fotos.length === 0 && videos.length === 0) {
        portfolioContainer.innerHTML = '<p class="text-muted">Nenhum trabalho no portf√≥lio</p>';
        return;
    }
    
    let html = '';
    
    // Fotos
    if (fotos.length > 0) {
        html += '<h6 class="mt-4 mb-3">Fotos</h6>';
        html += '<div class="galeria-grid">';
        fotos.forEach(foto => {
            html += `
                <div class="galeria-item">
                    <img src="${foto}" alt="Portf√≥lio" 
                         onclick="abrirImagemModal('${foto}')" 
                         style="cursor: pointer; width: 100%; height: 100%; object-fit: cover;">
                </div>
            `;
        });
        html += '</div>';
    }
    
    // V√≠deos
    if (videos.length > 0) {
        html += '<h6 class="mt-4 mb-3">V√≠deos</h6>';
        videos.forEach(video => {
            html += `
                <div class="mb-3">
                    <div class="ratio ratio-16x9">
                        <iframe src="${embedVideoUrl(video)}" 
                                title="V√≠deo do portf√≥lio" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                    <small class="text-muted d-block mt-1">${extrairNomeVideo(video)}</small>
                </div>
            `;
        });
    }
    
    portfolioContainer.innerHTML = html;
}

// ATUALIZAR BADGES
function atualizarBadges() {
    // Cat√°logo
    if (catalogoContainer && badgeCatalogo) {
        const catalogoItens = catalogoContainer.querySelectorAll('.catalogo-item').length;
        badgeCatalogo.textContent = catalogoItens;
    }
    
    // Portf√≥lio
    if (badgePortfolio) {
        const profData = profissionalAtual?.profissional || {};
        const fotos = profData.portfolioFotos || [];
        const videos = profData.videos || [];
        badgePortfolio.textContent = fotos.length + videos.length;
    }
}

// INICIALIZAR ABAS DO MODAL
function inicializarAbasModal() {
    modalTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Remover active
            modalTabs.forEach(t => t.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));
            
            // Adicionar active
            this.classList.add('active');
            const tabId = this.dataset.tab;
            const tabPane = document.getElementById(`tab${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`);
            if (tabPane) tabPane.classList.add('active');
        });
    });
}

// INICIALIZAR EVENT LISTENERS
function inicializarEventListeners() {
    console.log('üîß Configurando eventos...');
    
    // Busca com debounce
    if (inputBusca) {
        let timeout;
        inputBusca.addEventListener('input', function() {
            clearTimeout(timeout);
            timeout = setTimeout(() => aplicarFiltros(), 500);
        });
    }
    
    // Especialidade
    if (selectEspecialidade) {
        selectEspecialidade.addEventListener('change', function() {
            console.log('Especialidade selecionada:', this.value);
            aplicarFiltros();
        });
    }
    
    // Cidade com debounce
    if (inputCidade) {
        let timeout;
        inputCidade.addEventListener('input', function() {
            clearTimeout(timeout);
            timeout = setTimeout(() => aplicarFiltros(), 500);
        });
    }
    
    // Ordena√ß√£o
    if (selectOrdenar) {
        selectOrdenar.addEventListener('change', aplicarFiltros);
    }
    
    // Bot√£o Tenho Interesse
    if (btnInteresseModal) {
        btnInteresseModal.addEventListener('click', () => {
            alert('Funcionalidade "Tenho Interesse" em desenvolvimento!');
        });
    }
    
    console.log('‚úÖ Eventos configurados');
}

// FUN√á√ïES AUXILIARES
function formatarExperiencia(anos) {
    if (!anos) return '-';
    const map = {
        '1': 'Menos de 1 ano',
        '1-3': '1-3 anos',
        '3-5': '3-5 anos',
        '5-10': '5-10 anos',
        '10+': 'Mais de 10 anos'
    };
    return map[anos] || anos;
}

function formatarTempoResposta(tempo) {
    if (!tempo) return '-';
    const map = {
        '1': 'At√© 1 hora',
        '2': 'At√© 2 horas',
        '4': 'At√© 4 horas',
        '24': 'At√© 24 horas',
        '48': 'At√© 48 horas'
    };
    return map[tempo] || tempo;
}

function formatarPreco(valor) {
    if (valor === undefined || valor === null) return 'R$ --';
    return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
    }).format(valor);
}

function preencherTags(container, items) {
    if (!container) return;
    container.innerHTML = '';
    
    if (!items || !Array.isArray(items) || items.length === 0) {
        container.innerHTML = '<span class="text-muted">-</span>';
        return;
    }
    
    items.forEach(item => {
        if (item && item.trim()) {
            const tag = document.createElement('span');
            tag.className = 'tag';
            tag.textContent = item;
            container.appendChild(tag);
        }
    });
}

function abrirWhatsApp(numero, prof) {
    const numeroLimpo = numero.replace(/\D/g, '');
    const numeroFinal = numeroLimpo.startsWith('55') ? numeroLimpo : `55${numeroLimpo}`;
    
    const nomeProfissional = prof.profissional.nomeProfissional || prof.apelido || 'Profissional';
    const especialidade = formatarEspecialidade(prof.profissional.especialidadePrincipal);
    
    const mensagem = encodeURIComponent(
        `Ol√° ${nomeProfissional}! Vi seu perfil no ScanHub e tenho interesse no seu servi√ßo de ${especialidade}. Podemos conversar?`
    );
    
    window.open(`https://wa.me/${numeroFinal}?text=${mensagem}`, '_blank');
}

function embedVideoUrl(url) {
    if (!url) return '';
    
    // YouTube
    const youtubeMatch = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
    if (youtubeMatch) return `https://www.youtube.com/embed/${youtubeMatch[1]}`;
    
    // Vimeo
    const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
    if (vimeoMatch) return `https://player.vimeo.com/video/${vimeoMatch[1]}`;
    
    return url;
}

function extrairNomeVideo(url) {
    if (!url) return 'V√≠deo';
    if (url.includes('youtube')) return 'YouTube';
    if (url.includes('vimeo')) return 'Vimeo';
    return 'V√≠deo';
}

// MOSTRAR ERRO
function mostrarErro(mensagem) {
    if (!profissionaisGrid) return;
    
    profissionaisGrid.innerHTML = `
        <div class="col-12">
            <div class="alert alert-danger text-center">
                <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                <h4>Erro!</h4>
                <p>${mensagem}</p>
                <button class="btn btn-danger mt-2" onclick="window.location.reload()">
                    <i class="fas fa-redo me-2"></i>Recarregar P√°gina
                </button>
            </div>
        </div>
    `;
}

// FUN√á√ïES GLOBAIS
window.abrirImagemModal = function(url) {
    const modalHtml = `
        <div class="modal fade" id="imagemModal">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-body p-0">
                        <img src="${url}" class="img-fluid w-100">
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('imagemModal'));
    modal.show();
    
    // Limpar ap√≥s fechar
    document.getElementById('imagemModal').addEventListener('hidden.bs.modal', function() {
        this.remove();
    });
};

// FUN√á√ÉO DE DEBUG
window.debugBusca = function() {
    console.log('=== DEBUG BUSCA ===');
    console.log('Total profissionais:', todosProfissionais.length);
    console.log('Profissionais:', todosProfissionais);
    console.log('Especialidades:', Array.from(especialidadesUnicas));
    console.log('Select valor:', selectEspecialidade ? selectEspecialidade.value : 'N/A');
    aplicarFiltros();
};

// INICIAR
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>