<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Profissionais - ScanHub</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #44689a;
            --secondary-color: #FF6B35;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.1);
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f8f9fa;
            color: #333;
            padding-top: 80px;
        }

        /* Navbar */
        .navbar {
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .navbar-brand img {
            height: 60px;
            transform: scale(2);
            transform-origin: left center;
        }

        /* Header Busca */
        .header-busca {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }

        .search-box {
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
            z-index: 10;
        }

        .search-box input {
            padding-left: 50px;
            height: 56px;
            border-radius: 12px;
            border: 2px solid var(--gray-200);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-box input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(68, 104, 154, 0.1);
        }

        /* Filtros */
        .filtros-container {
            background: var(--gray-100);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid var(--gray-200);
        }

        /* Grid de Profissionais */
        .profissionais-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (min-width: 768px) {
            .profissionais-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 992px) {
            .profissionais-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1200px) {
            .profissionais-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Card do Profissional */
        .profissional-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            border: 1px solid var(--gray-200);
            height: 100%;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .profissional-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-avatar {
            width: 100%;
            height: 180px;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .card-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-content {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            margin-bottom: 12px;
        }

        .card-categoria {
            background: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 8px;
        }

        .card-nome {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-cidade {
            color: var(--gray-600);
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .card-descricao {
            color: #555;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .card-estrelas {
            color: #FFD700;
            font-size: 0.9rem;
        }

        .card-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .card-btn:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        /* Modal do Profissional */
        .modal-profissional .modal-dialog {
            max-width: 900px;
        }

        .modal-profissional .modal-content {
            border-radius: 20px;
            overflow: hidden;
            border: none;
        }

        .modal-header-profissional {
            background: linear-gradient(135deg, var(--primary-color) 0%, #5a82c2 100%);
            color: white;
            padding: 30px;
            position: relative;
            border: none;
        }

        .modal-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 5px solid white;
            overflow: hidden;
            margin-bottom: 20px;
            background: var(--gray-100);
        }

        .modal-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-profissional .btn-close {
            filter: brightness(0) invert(1);
            opacity: 0.8;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .modal-profissional .btn-close:hover {
            opacity: 1;
        }

        /* Abas do Modal */
        .modal-tabs {
            display: flex;
            border-bottom: 2px solid var(--gray-200);
            background: white;
            padding: 0 30px;
        }

        .modal-tab {
            padding: 15px 20px;
            background: none;
            border: none;
            font-weight: 500;
            color: var(--gray-600);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .modal-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .modal-tab-badge {
            background: var(--gray-200);
            color: var(--gray-600);
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .modal-tab.active .modal-tab-badge {
            background: var(--primary-color);
            color: white;
        }

        .modal-body-profissional {
            padding: 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Conteúdo das Abas */
        .tab-content {
            padding: 30px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Seção Sobre */
        .secao-titulo {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gray-200);
        }

        .info-item {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .info-item i {
            color: var(--primary-color);
            margin-right: 10px;
            margin-top: 3px;
            width: 20px;
        }

        .info-label {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .info-value {
            color: #555;
            line-height: 1.5;
        }

        /* Tags */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .tag {
            background: var(--gray-100);
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Galeria */
        .galeria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .galeria-item {
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1;
            background: var(--gray-100);
        }

        .galeria-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .galeria-item:hover img {
            transform: scale(1.05);
        }

        /* Catálogo */
        .catalogo-item {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .catalogo-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .catalogo-tipo {
            background: var(--gray-100);
            color: var(--gray-600);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .catalogo-preco {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        /* Botões Ação */
        .botoes-acao {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            transition: all 0.3s;
        }

        .btn-whatsapp:hover {
            background: #128C7E;
            color: white;
            transform: translateY(-2px);
        }

        .btn-interesse {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            transition: all 0.3s;
        }

        .btn-interesse:hover {
            background: #365a8a;
            transform: translateY(-2px);
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-600);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--gray-300);
            margin-bottom: 20px;
        }

        .empty-state h4 {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--gray-700);
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsivo */
        @media (max-width: 768px) {
            body {
                padding-top: 70px;
            }
            
            .header-busca {
                padding: 20px;
            }
            
            .modal-profissional .modal-dialog {
                margin: 10px;
            }
            
            .modal-header-profissional {
                padding: 20px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .botoes-acao {
                flex-direction: column;
            }
            
            .btn-whatsapp, .btn-interesse {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="dashboard-cliente.html">
                <img src="logoscanhub.png" alt="ScanHub">
            </a>
            <div class="d-flex align-items-center">
                <a href="dashboard-cliente.html" class="btn btn-outline-primary me-2">
                    <i class="fas fa-arrow-left me-2"></i>Voltar
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container py-4">
        <!-- Header com Busca -->
        <div class="header-busca">
            <h1 class="mb-4">Encontre o profissional ideal</h1>
            
            <div class="row g-3">
                <div class="col-md-8">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control" id="inputBusca" 
                               placeholder="O que você precisa? Ex: encanador, eletricista, designer...">
                    </div>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="selectEspecialidade">
                        <option value="">Todas especialidades</option>
                        <!-- Será preenchido via JavaScript -->
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="text" class="form-control" id="inputCidade" placeholder="Cidade">
                </div>
            </div>
        </div>

        <!-- Filtros Rápidos -->
        <div class="filtros-container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h6 class="mb-0" id="contadorResultados">Carregando profissionais...</h6>
                </div>
                <div class="col-md-6 text-end">
                    <select class="form-select form-select-sm w-auto d-inline-block" id="selectOrdenar">
                        <option value="relevancia">Mais relevantes</option>
                        <option value="nome">Nome A-Z</option>
                        <option value="cidade">Cidade</option>
                        <option value="avaliacao">Melhor avaliados</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Grid de Profissionais -->
        <div class="profissionais-grid" id="profissionaisGrid">
            <!-- Cards serão inseridos aqui via JavaScript -->
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <h4>Buscando profissionais...</h4>
                <p>Carregando lista de profissionais disponíveis</p>
            </div>
        </div>

        <!-- Paginação -->
        <nav id="paginacao" style="display: none;">
            <ul class="pagination justify-content-center">
                <!-- Paginação será gerada via JavaScript -->
            </ul>
        </nav>
    </div>

    <!-- Modal Profissional -->
    <div class="modal fade modal-profissional" id="modalProfissional" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <!-- Header com foto e informações básicas -->
                <div class="modal-header-profissional">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    
                    <div class="text-center">
                        <div class="modal-avatar mx-auto" id="modalAvatar">
                            <i class="fas fa-user fa-3x text-muted" style="line-height: 110px;"></i>
                        </div>
                        <h3 id="modalNome">Nome do Profissional</h3>
                        <p id="modalSlogan" class="mb-2">Slogan do profissional</p>
                        <div class="d-flex justify-content-center align-items-center gap-3">
                            <span id="modalEspecialidade" class="badge bg-light text-dark">Especialidade</span>
                            <span id="modalCidade" class="text-light"><i class="fas fa-map-marker-alt"></i> Cidade</span>
                        </div>
                    </div>
                </div>

                <!-- Abas -->
                <div class="modal-tabs">
                    <button class="modal-tab active" data-tab="sobre">
                        <i class="fas fa-user me-2"></i>Sobre
                    </button>
                    <button class="modal-tab" data-tab="catalogo">
                        <i class="fas fa-boxes me-2"></i>Catálogo
                        <span class="modal-tab-badge" id="badgeCatalogo">0</span>
                    </button>
                    <button class="modal-tab" data-tab="portfolio">
                        <i class="fas fa-images me-2"></i>Portfólio
                        <span class="modal-tab-badge" id="badgePortfolio">0</span>
                    </button>
                    <button class="modal-tab" data-tab="contato">
                        <i class="fas fa-address-book me-2"></i>Contato
                    </button>
                </div>

                <!-- Conteúdo das Abas -->
                <div class="modal-body-profissional">
                    <!-- ABA: SOBRE -->
                    <div class="tab-content">
                        <div class="tab-pane active" id="tabSobre">
                            <!-- Descrição -->
                            <div class="mb-4">
                                <h6 class="secao-titulo">Descrição</h6>
                                <p id="modalDescricao" class="info-value">Carregando...</p>
                            </div>

                            <!-- Informações Profissionais -->
                            <div class="mb-4">
                                <h6 class="secao-titulo">Informações Profissionais</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-briefcase"></i>
                                            <div>
                                                <div class="info-label">Especialidade Principal</div>
                                                <div class="info-value" id="infoEspecialidade">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-calendar-alt"></i>
                                            <div>
                                                <div class="info-label">Experiência</div>
                                                <div class="info-value" id="infoExperiencia">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-tags"></i>
                                            <div>
                                                <div class="info-label">Sub-especialidades</div>
                                                <div class="tags-container" id="infoTags">
                                                    <!-- Tags serão inseridas aqui -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Área de Atendimento -->
                            <div class="mb-4">
                                <h6 class="secao-titulo">Área de Atendimento</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <div>
                                                <div class="info-label">Cidade Base</div>
                                                <div class="info-value" id="infoCidadeBase">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-ruler"></i>
                                            <div>
                                                <div class="info-label">Raio de Atendimento</div>
                                                <div class="info-value" id="infoRaioKm">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="info-item">
                                            <i class="fas fa-map-pin"></i>
                                            <div>
                                                <div class="info-label">Cidades Atendidas</div>
                                                <div class="tags-container" id="infoCidadesAtendidas">
                                                    <!-- Cidades serão inseridas aqui -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-home"></i>
                                            <div>
                                                <div class="info-label" id="infoAtendeDomicilio">Atende em domicílio: -</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-laptop"></i>
                                            <div>
                                                <div class="info-label" id="infoAtendeOnline">Atende online: -</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Formas de Trabalho -->
                            <div class="mb-4">
                                <h6 class="secao-titulo">Formas de Trabalho</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-money-bill-wave"></i>
                                            <div>
                                                <div class="info-label">Formas de Pagamento</div>
                                                <div class="tags-container" id="infoFormasPagamento">
                                                    <!-- Formas de pagamento serão inseridas aqui -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-clock"></i>
                                            <div>
                                                <div class="info-label">Tempo de Resposta</div>
                                                <div class="info-value" id="infoTempoResposta">-</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-file-invoice-dollar"></i>
                                            <div>
                                                <div class="info-label" id="infoOrcamentoGratuito">Orçamento gratuito: -</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-item">
                                            <i class="fas fa-shield-alt"></i>
                                            <div>
                                                <div class="info-label">Garantia Oferecida</div>
                                                <div class="info-value" id="infoGarantia">-</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ABA: CATÁLOGO -->
                        <div class="tab-pane" id="tabCatalogo">
                            <h6 class="secao-titulo">Serviços & Produtos</h6>
                            <div id="catalogoContainer">
                                <p class="text-muted">Carregando catálogo...</p>
                            </div>
                        </div>

                        <!-- ABA: PORTFÓLIO -->
                        <div class="tab-pane" id="tabPortfolio">
                            <h6 class="secao-titulo">Portfólio - Trabalhos Realizados</h6>
                            <div id="portfolioContainer">
                                <p class="text-muted">Carregando portfólio...</p>
                            </div>
                        </div>

                        <!-- ABA: CONTATO -->
                        <div class="tab-pane" id="tabContato">
                            <h6 class="secao-titulo">Informações de Contato</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="info-item">
                                        <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                                        <div>
                                            <div class="info-label">WhatsApp</div>
                                            <div class="info-value" id="infoWhatsapp">-</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-item">
                                        <i class="fas fa-envelope"></i>
                                        <div>
                                            <div class="info-label">E-mail Profissional</div>
                                            <div class="info-value" id="infoEmail">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <h6 class="secao-titulo">Links</h6>
                                <div id="infoLinks">
                                    <p class="text-muted">Nenhum link disponível</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="botoes-acao">
                        <button class="btn-whatsapp" id="btnWhatsappModal">
                            <i class="fab fa-whatsapp"></i>
                            Conversar no WhatsApp
                        </button>
                        <button class="btn-interesse" id="btnInteresseModal">
                            <i class="fas fa-handshake"></i>
                            Tenho Interesse
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { 
        getFirestore, 
        collection, 
        getDocs,
        query,
        where,
        orderBy
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAYqWTg2RAr4IbqxRsl58TZGQ9tKnyFK14",
        authDomain: "scanhub-ed512.firebaseapp.com",
        projectId: "scanhub-ed512",
        storageBucket: "scanhub-ed512.firebasestorage.app",
        messagingSenderId: "1083305018831",
        appId: "1:1083305018831:web:f7594d560439c8965c3eba"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Elementos DOM
    const loadingOverlay = document.getElementById('loadingOverlay');
    const inputBusca = document.getElementById('inputBusca');
    const selectEspecialidade = document.getElementById('selectEspecialidade');
    const inputCidade = document.getElementById('inputCidade');
    const selectOrdenar = document.getElementById('selectOrdenar');
    const contadorResultados = document.getElementById('contadorResultados');
    const profissionaisGrid = document.getElementById('profissionaisGrid');
    
    // Modal elements
    const modalProfissionalElement = document.getElementById('modalProfissional');
    const modalProfissional = modalProfissionalElement ? new bootstrap.Modal(modalProfissionalElement) : null;
    const modalAvatar = document.getElementById('modalAvatar');
    const modalNome = document.getElementById('modalNome');
    const modalSlogan = document.getElementById('modalSlogan');
    const modalEspecialidade = document.getElementById('modalEspecialidade');
    const modalCidade = document.getElementById('modalCidade');
    const modalDescricao = document.getElementById('modalDescricao');
    const btnWhatsappModal = document.getElementById('btnWhatsappModal');
    const btnInteresseModal = document.getElementById('btnInteresseModal');
    
    // Info elements
    const infoEspecialidade = document.getElementById('infoEspecialidade');
    const infoExperiencia = document.getElementById('infoExperiencia');
    const infoTags = document.getElementById('infoTags');
    const infoCidadeBase = document.getElementById('infoCidadeBase');
    const infoRaioKm = document.getElementById('infoRaioKm');
    const infoCidadesAtendidas = document.getElementById('infoCidadesAtendidas');
    const infoAtendeDomicilio = document.getElementById('infoAtendeDomicilio');
    const infoAtendeOnline = document.getElementById('infoAtendeOnline');
    const infoFormasPagamento = document.getElementById('infoFormasPagamento');
    const infoTempoResposta = document.getElementById('infoTempoResposta');
    const infoOrcamentoGratuito = document.getElementById('infoOrcamentoGratuito');
    const infoGarantia = document.getElementById('infoGarantia');
    const infoWhatsapp = document.getElementById('infoWhatsapp');
    const infoEmail = document.getElementById('infoEmail');
    const infoLinks = document.getElementById('infoLinks');
    
    // Tab elements
    const modalTabs = document.querySelectorAll('.modal-tab');
    const badgeCatalogo = document.getElementById('badgeCatalogo');
    const badgePortfolio = document.getElementById('badgePortfolio');
    const tabPanes = document.querySelectorAll('.tab-pane');
    const catalogoContainer = document.getElementById('catalogoContainer');
    const portfolioContainer = document.getElementById('portfolioContainer');

    // Variáveis globais
    let todosProfissionais = [];
    let profissionaisFiltrados = [];
    let especialidadesUnicas = new Set();
    let profissionalAtual = null;

    // Especialidades padrão
    const especialidadesPadrao = [
        'advocacia', 'alarme', 'alvenaria', 'antena', 'ar_condicionado',
        'arquitetura', 'artes_marciais', 'babysitter', 'barbeiro',
        'cabeleireiro', 'calhas', 'cerca_eletrica', 'ceramica', 'chaveiro',
        'coach', 'consultoria', 'construcao', 'contabilidade',
        'costura', 'cuidador', 'danca', 'dedetizacao', 'design',
        'design_interiores', 'eletrica', 'eletrodomesticos', 'eletronica',
        'encanador', 'engenharia', 'entregador', 'eventos', 'festas',
        'fotografo', 'forro', 'funilaria', 'gesso', 'guias_turismo',
        'hidraulica', 'impermeabilizacao', 'jardineiro', 'jardinagem',
        'jato_areia', 'lavanderia', 'limpeza', 'logistica', 'manicure',
        'marcenaria', 'marketing_digital', 'massoterapia', 'mecanica',
        'montador', 'motorista', 'musico', 'nutricionista', 'organizacao',
        'personal_trainer', 'pet_sitter', 'pintura', 'piso', 'piscina',
        'portao', 'programador', 'professor', 'psicologia', 'rede',
        'redator', 'reforma', 'seguranca', 'serralheria',
        'sistema_fotovoltaico', 'social_media', 'solda', 'som',
        'tecnico_celular', 'telhado', 'ti', 'traducao',
        'turismo', 'veterinaria', 'video_maker', 'vidracaria',
        'web_designer', 'yoga', 'outro'
    ];

    // Inicializar
    async function init() {
        console.log('Inicializando busca-profissional...');
        showLoading();
        try {
            await carregarProfissionais();
            preencherFiltroEspecialidades();
            aplicarFiltros();
            inicializarEventListeners();
            console.log('Inicialização concluída com', todosProfissionais.length, 'profissionais');
        } catch (error) {
            console.error('Erro na inicialização:', error);
            mostrarErro('Erro ao carregar profissionais');
        } finally {
            hideLoading();
        }
    }

    // Mostrar loading
    function showLoading() {
        if (loadingOverlay) loadingOverlay.classList.add('active');
    }

    // Esconder loading
    function hideLoading() {
        if (loadingOverlay) loadingOverlay.classList.remove('active');
    }

    // Carregar profissionais do Firestore
    async function carregarProfissionais() {
        try {
            const usuariosRef = collection(db, "usuarios");
            const q = query(
                usuariosRef,
                where("tipoUsuario", "==", "profissional"),
                where("status", "==", "ativo")
            );
            
            const querySnapshot = await getDocs(q);
            todosProfissionais = [];
            especialidadesUnicas.clear();
            
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                
                // Verificar se o profissional tem perfil completo
                if (data.profissional && data.profissional.perfilCompleto === true) {
                    const profissional = {
                        id: doc.id,
                        ...data,
                        profissional: data.profissional || {}
                    };
                    
                    todosProfissionais.push(profissional);
                    
                    // Coletar especialidades únicas para o filtro
                    if (profissional.profissional.especialidadePrincipal) {
                        especialidadesUnicas.add(profissional.profissional.especialidadePrincipal);
                    }
                }
            });
            
            console.log(`Carregados ${todosProfissionais.length} profissionais`);
            
        } catch (error) {
            console.error('Erro ao carregar profissionais:', error);
            throw error;
        }
    }

    // Preencher filtro de especialidades
    function preencherFiltroEspecialidades() {
        if (!selectEspecialidade) return;
        
        // Limpar opções
        selectEspecialidade.innerHTML = '<option value="">Todas especialidades</option>';
        
        // Adicionar especialidades encontradas
        Array.from(especialidadesUnicas).sort().forEach(especialidade => {
            const option = document.createElement('option');
            option.value = especialidade;
            
            // Converter para formato mais amigável (remover underscores, capitalizar)
            let textoAmigavel = especialidade.replace(/_/g, ' ');
            textoAmigavel = textoAmigavel.charAt(0).toUpperCase() + textoAmigavel.slice(1);
            
            option.textContent = textoAmigavel;
            selectEspecialidade.appendChild(option);
        });
        
        console.log(`${especialidadesUnicas.size} especialidades encontradas`);
    }

    // Aplicar filtros
    function aplicarFiltros() {
        console.log('Aplicando filtros...');
        
        const buscaTexto = inputBusca ? inputBusca.value.toLowerCase().trim() : '';
        const especialidadeFiltro = selectEspecialidade ? selectEspecialidade.value : '';
        const cidadeFiltro = inputCidade ? inputCidade.value.toLowerCase().trim() : '';
        const ordenarPor = selectOrdenar ? selectOrdenar.value : 'relevancia';
        
        console.log('Filtros:', { buscaTexto, especialidadeFiltro, cidadeFiltro, ordenarPor });
        
        // Filtrar profissionais
        profissionaisFiltrados = todosProfissionais.filter(prof => {
            const profData = prof.profissional;
            
            // Filtro por texto
            let matchTexto = true;
            if (buscaTexto) {
                const textoBusca = buscaTexto.toLowerCase();
                matchTexto = 
                    (profData.nomeProfissional && profData.nomeProfissional.toLowerCase().includes(textoBusca)) ||
                    (profData.descricao && profData.descricao.toLowerCase().includes(textoBusca)) ||
                    (profData.slogan && profData.slogan.toLowerCase().includes(textoBusca)) ||
                    (profData.especialidadePrincipal && profData.especialidadePrincipal.toLowerCase().includes(textoBusca)) ||
                    (prof.apelido && prof.apelido.toLowerCase().includes(textoBusca)) ||
                    (profData.cidadeBase && profData.cidadeBase.toLowerCase().includes(textoBusca));
            }
            
            // Filtro por especialidade
            let matchEspecialidade = true;
            if (especialidadeFiltro) {
                matchEspecialidade = profData.especialidadePrincipal === especialidadeFiltro;
            }
            
            // Filtro por cidade
            let matchCidade = true;
            if (cidadeFiltro) {
                matchCidade = 
                    (profData.cidadeBase && profData.cidadeBase.toLowerCase().includes(cidadeFiltro)) ||
                    (profData.cidadesAtendidas && 
                     Array.isArray(profData.cidadesAtendidas) &&
                     profData.cidadesAtendidas.some(cidade => 
                         cidade && cidade.toLowerCase().includes(cidadeFiltro)
                     ));
            }
            
            return matchTexto && matchEspecialidade && matchCidade;
        });
        
        console.log(`Filtrados: ${profissionaisFiltrados.length} de ${todosProfissionais.length}`);
        
        // Ordenar resultados
        ordenarResultados(ordenarPor);
        
        // Atualizar interface
        atualizarContadorResultados();
        renderizarProfissionais();
    }

    // Ordenar resultados
    function ordenarResultados(criterio) {
        switch(criterio) {
            case 'nome':
                profissionaisFiltrados.sort((a, b) => {
                    const nomeA = a.profissional.nomeProfissional || '';
                    const nomeB = b.profissional.nomeProfissional || '';
                    return nomeA.localeCompare(nomeB);
                });
                break;
                
            case 'cidade':
                profissionaisFiltrados.sort((a, b) => {
                    const cidadeA = a.profissional.cidadeBase || '';
                    const cidadeB = b.profissional.cidadeBase || '';
                    return cidadeA.localeCompare(cidadeB);
                });
                break;
                
            case 'avaliacao':
                // TODO: Implementar quando tiver sistema de avaliações
                break;
                
            default: // relevancia
                // Mantém a ordem original
                break;
        }
    }

    // Atualizar contador de resultados
    function atualizarContadorResultados() {
        if (!contadorResultados) return;
        
        const total = profissionaisFiltrados.length;
        let texto = '';
        
        if (total === 0) {
            texto = 'Nenhum profissional encontrado';
        } else if (total === 1) {
            texto = '1 profissional encontrado';
        } else {
            texto = `${total} profissionais encontrados`;
        }
        
        contadorResultados.textContent = texto;
    }

    // Renderizar profissionais na grid
    function renderizarProfissionais() {
        if (!profissionaisGrid) return;
        
        profissionaisGrid.innerHTML = '';
        
        if (profissionaisFiltrados.length === 0) {
            profissionaisGrid.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h4>Nenhum profissional encontrado</h4>
                    <p>Tente ajustar os filtros de busca</p>
                </div>
            `;
            return;
        }
        
        profissionaisFiltrados.forEach(prof => {
            const card = criarCardProfissional(prof);
            if (card) {
                profissionaisGrid.appendChild(card);
            }
        });
    }

    // Criar card do profissional
    function criarCardProfissional(prof) {
        const profData = prof.profissional;
        const card = document.createElement('div');
        card.className = 'profissional-card';
        card.dataset.id = prof.id;
        
        // Foto do profissional
        const foto = prof.fotoPerfilProfissional || prof.fotoPerfil || '';
        const fotoHtml = foto 
            ? `<img src="${foto}" alt="${profData.nomeProfissional || 'Profissional'}" 
                 onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-user fa-3x text-muted\\' style=\\'line-height: 180px;\\'></i>';">`
            : '<i class="fas fa-user fa-3x text-muted" style="line-height: 180px;"></i>';
        
        // Descrição curta (limitar)
        const descricao = profData.descricao || '';
        const descricaoCurta = descricao.length > 100 
            ? descricao.substring(0, 100) + '...' 
            : descricao || 'Sem descrição';
        
        // Cidade
        const cidade = profData.cidadeBase || 'Localização não informada';
        
        // Especialidade formatada
        let especialidadeTexto = profData.especialidadePrincipal || 'Profissional';
        especialidadeTexto = especialidadeTexto.replace(/_/g, ' ');
        especialidadeTexto = especialidadeTexto.charAt(0).toUpperCase() + especialidadeTexto.slice(1);
        
        card.innerHTML = `
            <div class="card-avatar">
                ${fotoHtml}
            </div>
            <div class="card-content">
                <div class="card-header">
                    <span class="card-categoria">${especialidadeTexto}</span>
                    <h4 class="card-nome">${profData.nomeProfissional || prof.apelido || 'Profissional'}</h4>
                    <p class="card-cidade"><i class="fas fa-map-marker-alt"></i> ${cidade}</p>
                </div>
                <p class="card-descricao">${descricaoCurta}</p>
                <div class="card-footer">
                    <div class="card-estrelas">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                        <small class="text-muted">(4.5)</small>
                    </div>
                    <button class="card-btn btn-ver-perfil">
                        Ver Perfil
                    </button>
                </div>
            </div>
        `;
        
        // Adicionar evento de clique no botão
        const btnVerPerfil = card.querySelector('.btn-ver-perfil');
        if (btnVerPerfil) {
            btnVerPerfil.addEventListener('click', (e) => {
                e.stopPropagation();
                abrirModalProfissional(prof);
            });
        }
        
        // Adicionar evento de clique no card inteiro
        card.addEventListener('click', (e) => {
            if (!e.target.closest('.btn-ver-perfil')) {
                abrirModalProfissional(prof);
            }
        });
        
        return card;
    }

    // Abrir modal com detalhes do profissional
    async function abrirModalProfissional(prof) {
        if (!modalProfissional) {
            console.error('Modal não encontrado');
            return;
        }
        
        profissionalAtual = prof;
        const profData = prof.profissional;
        
        showLoading();
        
        try {
            // Preencher informações básicas
            const foto = prof.fotoPerfilProfissional || prof.fotoPerfil || '';
            if (foto && modalAvatar) {
                modalAvatar.innerHTML = `<img src="${foto}" alt="${profData.nomeProfissional || 'Profissional'}" 
                    onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-user fa-3x text-muted\\' style=\\'line-height: 110px;\\'></i>';">`;
            } else if (modalAvatar) {
                modalAvatar.innerHTML = '<i class="fas fa-user fa-3x text-muted" style="line-height: 110px;"></i>';
            }
            
            if (modalNome) modalNome.textContent = profData.nomeProfissional || prof.apelido || 'Profissional';
            if (modalSlogan) modalSlogan.textContent = profData.slogan || 'Profissional qualificado';
            
            // Especialidade formatada
            let especialidadeTexto = profData.especialidadePrincipal || 'Profissional';
            especialidadeTexto = especialidadeTexto.replace(/_/g, ' ');
            especialidadeTexto = especialidadeTexto.charAt(0).toUpperCase() + especialidadeTexto.slice(1);
            
            if (modalEspecialidade) modalEspecialidade.textContent = especialidadeTexto;
            if (modalCidade) modalCidade.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${profData.cidadeBase || 'Localização não informada'}`;
            if (modalDescricao) modalDescricao.textContent = profData.descricao || 'Sem descrição disponível.';
            
            // Preencher informações detalhadas
            if (infoEspecialidade) infoEspecialidade.textContent = especialidadeTexto;
            if (infoExperiencia) infoExperiencia.textContent = formatarExperiencia(profData.anosExperiencia);
            if (infoCidadeBase) infoCidadeBase.textContent = profData.cidadeBase || '-';
            if (infoRaioKm) infoRaioKm.textContent = profData.raioKm ? `${profData.raioKm} km` : '-';
            if (infoTempoResposta) infoTempoResposta.textContent = formatarTempoResposta(profData.tempoResposta);
            if (infoOrcamentoGratuito) infoOrcamentoGratuito.textContent = `Orçamento gratuito: ${profData.orcamentoGratuito ? 'Sim' : 'Não'}`;
            if (infoGarantia) infoGarantia.textContent = profData.garantiaDias ? `${profData.garantiaDias} dias` : '-';
            if (infoAtendeDomicilio) infoAtendeDomicilio.textContent = `Atende em domicílio: ${profData.atendeDomicilio ? 'Sim' : 'Não'}`;
            if (infoAtendeOnline) infoAtendeOnline.textContent = `Atende online: ${profData.atendeOnline ? 'Sim' : 'Não'}`;
            
            // WhatsApp
            const whatsapp = profData.whatsapp || prof.celular || '';
            if (infoWhatsapp) infoWhatsapp.textContent = whatsapp || 'Não informado';
            if (btnWhatsappModal) {
                if (whatsapp) {
                    btnWhatsappModal.style.display = 'flex';
                    btnWhatsappModal.onclick = () => abrirWhatsApp(whatsapp, prof);
                } else {
                    btnWhatsappModal.style.display = 'none';
                }
            }
            
            // Email
            if (infoEmail) infoEmail.textContent = profData.emailProfissional || prof.email || 'Não informado';
            
            // Preencher arrays (tags, cidades, etc.)
            if (infoTags) preencherTags(infoTags, profData.especialidades);
            if (infoCidadesAtendidas) preencherTags(infoCidadesAtendidas, profData.cidadesAtendidas);
            if (infoFormasPagamento) preencherTags(infoFormasPagamento, profData.formasPagamento);
            
            // Links
            if (infoLinks) {
                if (profData.links && Array.isArray(profData.links) && profData.links.length > 0 && profData.links[0]) {
                    infoLinks.innerHTML = profData.links.map(link => 
                        `<a href="${link}" target="_blank" class="d-block mb-2"><i class="fas fa-external-link-alt me-2"></i>${link}</a>`
                    ).join('');
                } else {
                    infoLinks.innerHTML = '<p class="text-muted">Nenhum link disponível</p>';
                }
            }
            
            // Carregar catálogo e portfólio
            await Promise.all([
                carregarCatalogoProfissional(prof.id),
                carregarPortfolioProfissional(profData)
            ]);
            
            // Atualizar badges
            atualizarBadges();
            
            // Inicializar abas do modal
            inicializarAbasModal();
            
            // Mostrar modal
            modalProfissional.show();
            
            console.log('Modal aberto para:', profData.nomeProfissional);
            
        } catch (error) {
            console.error('Erro ao abrir modal:', error);
            alert('Erro ao carregar detalhes do profissional');
        } finally {
            hideLoading();
        }
    }

    // Carregar catálogo do profissional
    async function carregarCatalogoProfissional(profissionalId) {
        if (!catalogoContainer) return;
        
        try {
            // Buscar serviços
            const servicosRef = collection(db, "servicos");
            const qServicos = query(
                servicosRef,
                where("profissionalId", "==", profissionalId),
                where("status", "==", "ativo")
            );
            
            const servicosSnapshot = await getDocs(qServicos);
            const servicos = [];
            servicosSnapshot.forEach(doc => {
                servicos.push({ id: doc.id, ...doc.data() });
            });
            
            // Buscar produtos
            const produtosRef = collection(db, "produtos");
            const qProdutos = query(
                produtosRef,
                where("profissionalId", "==", profissionalId),
                where("status", "==", "ativo")
            );
            
            const produtosSnapshot = await getDocs(qProdutos);
            const produtos = [];
            produtosSnapshot.forEach(doc => {
                produtos.push({ id: doc.id, ...doc.data() });
            });
            
            // Renderizar catálogo
            renderizarCatalogo(servicos, produtos);
            
        } catch (error) {
            console.error('Erro ao carregar catálogo:', error);
            catalogoContainer.innerHTML = '<p class="text-muted">Erro ao carregar catálogo</p>';
        }
    }

    // Renderizar catálogo
    function renderizarCatalogo(servicos, produtos) {
        if (!catalogoContainer) return;
        
        const totalItens = servicos.length + produtos.length;
        
        if (totalItens === 0) {
            catalogoContainer.innerHTML = '<p class="text-muted">Nenhum item no catálogo</p>';
            return;
        }
        
        let html = '';
        
        // Serviços
        servicos.forEach(servico => {
            html += `
                <div class="catalogo-item">
                    <div class="catalogo-item-header">
                        <div>
                            <h6 class="mb-1">${servico.nome || 'Serviço'}</h6>
                            <span class="catalogo-tipo">Serviço</span>
                        </div>
                        <div class="catalogo-preco">${formatarPreco(servico.precoVenda)}</div>
                    </div>
                    <p class="mb-2">${servico.descricao || 'Sem descrição'}</p>
                    ${servico.duracao ? `<small class="text-muted"><i class="far fa-clock"></i> ${servico.duracao}</small>` : ''}
                </div>
            `;
        });
        
        // Produtos
        produtos.forEach(produto => {
            const estoque = produto.estoqueAtual > 0 ? 
                `<span class="badge bg-success ms-2">${produto.estoqueAtual} em estoque</span>` : 
                `<span class="badge bg-danger ms-2">Esgotado</span>`;
            
            html += `
                <div class="catalogo-item">
                    <div class="catalogo-item-header">
                        <div>
                            <h6 class="mb-1">${produto.nome || 'Produto'}</h6>
                            <span class="catalogo-tipo">Produto</span>
                            ${estoque}
                        </div>
                        <div class="catalogo-preco">${formatarPreco(produto.precoVenda)}</div>
                    </div>
                    <p class="mb-2">${produto.descricao || 'Sem descrição'}</p>
                    ${produto.marca ? `<small class="text-muted"><i class="fas fa-tag"></i> ${produto.marca}</small>` : ''}
                </div>
            `;
        });
        
        catalogoContainer.innerHTML = html;
    }

    // Carregar portfólio
    async function carregarPortfolioProfissional(profData) {
        if (!portfolioContainer) return;
        
        const fotos = profData.portfolioFotos || [];
        const videos = profData.videos || [];
        
        if (fotos.length === 0 && videos.length === 0) {
            portfolioContainer.innerHTML = '<p class="text-muted">Nenhum trabalho no portfólio</p>';
            return;
        }
        
        let html = '';
        
        // Fotos
        if (fotos.length > 0) {
            html += '<h6 class="mt-4 mb-3">Fotos</h6>';
            html += '<div class="galeria-grid">';
            fotos.forEach(foto => {
                html += `
                    <div class="galeria-item">
                        <img src="${foto}" alt="Portfólio" onclick="abrirImagemModal('${foto}')" style="cursor: pointer;">
                    </div>
                `;
            });
            html += '</div>';
        }
        
        // Vídeos
        if (videos.length > 0) {
            html += '<h6 class="mt-4 mb-3">Vídeos</h6>';
            videos.forEach(video => {
                html += `
                    <div class="mb-3">
                        <div class="ratio ratio-16x9">
                            <iframe src="${embedVideoUrl(video)}" 
                                    title="Vídeo do portfólio" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                            </iframe>
                        </div>
                        <small class="text-muted d-block mt-1">${extrairNomeVideo(video)}</small>
                    </div>
                `;
            });
        }
        
        portfolioContainer.innerHTML = html;
    }

    // Atualizar badges das abas
    function atualizarBadges() {
        // Contar itens do catálogo
        if (catalogoContainer && badgeCatalogo) {
            const catalogoItens = catalogoContainer.querySelectorAll('.catalogo-item').length;
            badgeCatalogo.textContent = catalogoItens;
        }
        
        // Contar itens do portfólio
        if (badgePortfolio) {
            const profData = profissionalAtual?.profissional || {};
            const fotos = profData.portfolioFotos || [];
            const videos = profData.videos || [];
            const portfolioItens = fotos.length + videos.length;
            badgePortfolio.textContent = portfolioItens;
        }
    }

    // Inicializar abas do modal
    function inicializarAbasModal() {
        modalTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remover active de todas
                modalTabs.forEach(t => t.classList.remove('active'));
                tabPanes.forEach(pane => pane.classList.remove('active'));
                
                // Adicionar active na clicada
                this.classList.add('active');
                const tabId = this.dataset.tab;
                const tabPane = document.getElementById(`tab${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`);
                if (tabPane) {
                    tabPane.classList.add('active');
                }
            });
        });
    }

    // Funções auxiliares
    function formatarExperiencia(anos) {
        if (!anos) return '-';
        const map = {
            '1': 'Menos de 1 ano',
            '1-3': '1-3 anos',
            '3-5': '3-5 anos',
            '5-10': '5-10 anos',
            '10+': 'Mais de 10 anos'
        };
        return map[anos] || anos;
    }

    function formatarTempoResposta(tempo) {
        if (!tempo) return '-';
        const map = {
            '1': 'Até 1 hora',
            '2': 'Até 2 horas',
            '4': 'Até 4 horas',
            '24': 'Até 24 horas',
            '48': 'Até 48 horas'
        };
        return map[tempo] || tempo;
    }

    function formatarPreco(valor) {
        if (!valor && valor !== 0) return 'R$ --';
        return new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL'
        }).format(valor);
    }

    function preencherTags(container, items) {
        if (!container) return;
        
        container.innerHTML = '';
        
        if (!items || !Array.isArray(items) || items.length === 0) {
            container.innerHTML = '<span class="text-muted">-</span>';
            return;
        }
        
        items.forEach(item => {
            if (item && item.trim()) {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = item;
                container.appendChild(tag);
            }
        });
    }

    function abrirWhatsApp(numero, prof) {
        // Limpar número (remover tudo que não for dígito)
        const numeroLimpo = numero.replace(/\D/g, '');
        
        // Adicionar código do Brasil se não tiver
        const numeroFinal = numeroLimpo.startsWith('55') ? numeroLimpo : `55${numeroLimpo}`;
        
        // Mensagem pré-definida
        const nomeCliente = localStorage.getItem('userName') || 'Cliente ScanHub';
        const nomeProfissional = prof.profissional.nomeProfissional || prof.apelido || 'Profissional';
        const especialidade = prof.profissional.especialidadePrincipal || 'serviço';
        
        // Formatar especialidade
        let especialidadeFormatada = especialidade.replace(/_/g, ' ');
        especialidadeFormatada = especialidadeFormatada.charAt(0).toUpperCase() + especialidadeFormatada.slice(1);
        
        const mensagem = encodeURIComponent(
            `Olá ${nomeProfissional}! Sou ${nomeCliente}, vi seu perfil no ScanHub e tenho interesse no seu serviço de ${especialidadeFormatada}. Podemos conversar?`
        );
        
        // Abrir WhatsApp
        window.open(`https://wa.me/${numeroFinal}?text=${mensagem}`, '_blank');
    }

    function embedVideoUrl(url) {
        if (!url) return '';
        
        // YouTube
        if (url.includes('youtube.com') || url.includes('youtu.be')) {
            const videoId = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
            if (videoId && videoId[1]) {
                return `https://www.youtube.com/embed/${videoId[1]}`;
            }
        }
        // Vimeo
        else if (url.includes('vimeo.com')) {
            const videoId = url.match(/vimeo\.com\/(\d+)/);
            if (videoId && videoId[1]) {
                return `https://player.vimeo.com/video/${videoId[1]}`;
            }
        }
        return url;
    }

    function extrairNomeVideo(url) {
        if (!url) return 'Vídeo';
        if (url.includes('youtube.com') || url.includes('youtu.be')) {
            return 'Vídeo do YouTube';
        } else if (url.includes('vimeo.com')) {
            return 'Vídeo do Vimeo';
        }
        return 'Vídeo';
    }

    // Mostrar erro
    function mostrarErro(mensagem) {
        if (!profissionaisGrid) return;
        
        profissionaisGrid.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-exclamation-triangle"></i>
                <h4>Oops!</h4>
                <p>${mensagem}</p>
                <button class="btn btn-primary mt-3" onclick="window.location.reload()">
                    <i class="fas fa-redo me-2"></i>Tentar novamente
                </button>
            </div>
        `;
    }

    // Inicializar event listeners
    function inicializarEventListeners() {
        console.log('Configurando event listeners...');
        
        // Filtro de busca com debounce
        if (inputBusca) {
            let buscaTimeout;
            inputBusca.addEventListener('input', function() {
                console.log('Busca alterada:', this.value);
                clearTimeout(buscaTimeout);
                buscaTimeout = setTimeout(() => {
                    aplicarFiltros();
                }, 500);
            });
        }
        
        // Filtro de especialidade
        if (selectEspecialidade) {
            selectEspecialidade.addEventListener('change', function() {
                console.log('Especialidade selecionada:', this.value);
                aplicarFiltros();
            });
        }
        
        // Filtro de cidade
        if (inputCidade) {
            let cidadeTimeout;
            inputCidade.addEventListener('input', function() {
                console.log('Cidade alterada:', this.value);
                clearTimeout(cidadeTimeout);
                cidadeTimeout = setTimeout(() => {
                    aplicarFiltros();
                }, 500);
            });
        }
        
        // Ordenação
        if (selectOrdenar) {
            selectOrdenar.addEventListener('change', function() {
                console.log('Ordenação alterada:', this.value);
                aplicarFiltros();
            });
        }
        
        // Botão Tenho Interesse
        if (btnInteresseModal) {
            btnInteresseModal.addEventListener('click', function() {
                alert('Funcionalidade "Tenho Interesse" será implementada em breve!');
                // TODO: Implementar sistema de solicitações
            });
        }
        
        console.log('Event listeners configurados');
    }

    // Funções globais (para usar em onclick)
    window.abrirImagemModal = function(url) {
        // Remover modal anterior se existir
        const modalAntigo = document.getElementById('imagemModal');
        if (modalAntigo) modalAntigo.remove();
        
        // Criar modal para imagem
        const modalHtml = `
            <div class="modal fade" id="imagemModal" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body p-0">
                            <img src="${url}" class="img-fluid w-100" alt="Portfólio">
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Adicionar ao DOM
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        const imagemModalElement = document.getElementById('imagemModal');
        if (imagemModalElement) {
            const imagemModal = new bootstrap.Modal(imagemModalElement);
            imagemModal.show();
            
            // Remover do DOM quando fechar
            imagemModalElement.addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }
    };

    // Inicializar a aplicação quando o DOM carregar
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM carregado, inicializando...');
        init();
    });

    // Expor função de teste
    window.testarFiltros = function() {
        console.log('=== TESTANDO FILTROS ===');
        console.log('Total profissionais:', todosProfissionais.length);
        console.log('Especialidades únicas:', Array.from(especialidadesUnicas));
        console.log('Select especialidade valor:', selectEspecialidade ? selectEspecialidade.value : 'não encontrado');
        aplicarFiltros();
    };
</script>
</body>
</html>