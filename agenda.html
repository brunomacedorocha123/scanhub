<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda - ScanHub</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #44689a;
            --secondary-color: #FF6B35;
            --light-color: #e8ecef;
            --dark-color: #2c3e50;
            --white: #ffffff;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
            padding-top: 80px;
            overflow-x: hidden;
        }

        /* Logo Grande */
        .navbar-brand-dashboard {
            display: flex;
            align-items: center;
            transform: scale(2.5);
            transform-origin: left center;
            margin-right: 40px;
        }

        .navbar-brand-dashboard img {
            height: 60px;
            width: auto;
            object-fit: contain;
        }

        /* Navbar Dashboard */
        .navbar-dashboard {
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 15px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .navbar-dashboard .container-fluid {
            padding: 0 15px;
        }

        /* Bot√£o Menu Mobile */
        .mobile-menu-toggle {
            display: none !important;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark-color);
            padding: 5px 10px;
            margin-left: auto;
            z-index: 1001;
        }

        /* Menu Dashboard */
        .dashboard-menu {
            list-style: none;
            display: flex;
            gap: 5px;
            margin: 0;
            padding: 0;
            flex-wrap: wrap;
            transition: all 0.3s ease;
        }

        .dashboard-menu li {
            flex: 1;
            min-width: 120px;
        }

        .dashboard-menu a {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            color: var(--dark-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            border-radius: 10px;
            background: transparent;
            text-align: center;
        }

        .dashboard-menu a:hover,
        .dashboard-menu a.active {
            background: rgba(68, 104, 154, 0.1);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .dashboard-menu i {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .dashboard-menu span {
            font-size: 0.75rem;
            line-height: 1.2;
        }

        /* User Info */
        .user-info-mobile {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            min-height: calc(100vh - 80px);
            max-width: 100%;
            overflow-x: hidden;
        }

        /* Welcome Card */
        .welcome-card {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
        }

        .welcome-card h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        /* Agenda Header */
        .agenda-header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }

        .agenda-tabs {
            display: flex;
            border-bottom: 2px solid var(--gray-200);
            margin-bottom: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .agenda-tabs::-webkit-scrollbar {
            display: none;
        }

        .agenda-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            font-weight: 500;
            color: var(--gray-600);
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            font-size: 14px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .agenda-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Calendar Container */
        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        #calendar {
            min-height: 500px;
        }

        /* Calendar Custom Styles */
        .fc .fc-toolbar-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .fc .fc-button {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            font-weight: 500;
        }

        .fc .fc-button:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .fc .fc-daygrid-day-number {
            color: var(--gray-700);
            font-weight: 500;
        }

        .fc .fc-day-today {
            background-color: rgba(68, 104, 154, 0.1) !important;
        }

        /* Event Colors */
        .fc-event-servico {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .fc-event-visita {
            background-color: var(--info-color);
            border-color: var(--info-color);
        }

        .fc-event-reuniao {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }

        .fc-event-outro {
            background-color: var(--gray-600);
            border-color: var(--gray-600);
        }

        /* Compromissos List */
        .compromissos-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            max-height: 600px;
            overflow-y: auto;
        }

        .compromisso-card {
            background: var(--gray-100);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary-color);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .compromisso-card:hover {
            transform: translateX(5px);
            background: var(--gray-200);
        }

        .compromisso-card.servico {
            border-left-color: var(--primary-color);
        }

        .compromisso-card.visita {
            border-left-color: var(--info-color);
        }

        .compromisso-card.reuniao {
            border-left-color: var(--warning-color);
        }

        .compromisso-card.outro {
            border-left-color: var(--gray-600);
        }

        .compromisso-time {
            font-size: 0.9rem;
            color: var(--gray-600);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .compromisso-title {
            font-weight: 600;
            color: var(--gray-900);
            margin: 5px 0;
            font-size: 1rem;
        }

        .compromisso-details {
            font-size: 0.85rem;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .compromisso-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .compromisso-badge.confirmado {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }

        .compromisso-badge.pendente {
            background: rgba(241, 196, 15, 0.1);
            color: var(--warning-color);
        }

        .compromisso-badge.cancelado {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }

        /* Bot√µes de a√ß√£o nos cards - NOVO */
        .compromisso-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-compromisso {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-editar-compromisso {
            background: rgba(68, 104, 154, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(68, 104, 154, 0.2);
        }

        .btn-editar-compromisso:hover {
            background: rgba(68, 104, 154, 0.2);
        }

        .btn-excluir-compromisso {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(231, 76, 60, 0.2);
        }

        .btn-excluir-compromisso:hover {
            background: rgba(231, 76, 60, 0.2);
        }

        /* Anota√ß√µes Container */
        .anotacoes-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }

        .anotacoes-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid var(--gray-300);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .anotacoes-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(68, 104, 154, 0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-600);
        }

        .empty-state i {
            font-size: 48px;
            color: var(--gray-300);
            margin-bottom: 20px;
        }

        .empty-state h4 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--gray-700);
        }

        .empty-state p {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Bot√µes de A√ß√£o */
        .btn-primary-action {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #F7931E 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 15px;
            width: 100%;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        /* Modal */
        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            max-height: 90vh;
            overflow: hidden;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #2c3e50 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 20px 30px;
            border: none;
        }

        .modal-header .btn-close {
            filter: brightness(0) invert(1);
            opacity: 0.8;
        }

        .modal-header .btn-close:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        /* Form Styles */
        .form-label {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 8px;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e8ecef;
            padding: 10px 15px;
            transition: all 0.3s ease;
            font-size: 16px !important;
        }

        .form-control:focus, .form-select:focus {
            border-color: #FF6B35;
            box-shadow: 0 0 0 0.25rem rgba(255, 107, 53, 0.25);
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .navbar-brand-dashboard {
                transform: scale(2);
            }
        }

        @media (max-width: 992px) {
            .navbar-brand-dashboard {
                transform: scale(1.8);
                margin-right: 20px;
            }
            
            .mobile-menu-toggle {
                display: block !important;
            }
            
            .dashboard-menu {
                position: fixed;
                top: 80px;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                border-radius: 0 0 20px 20px;
                display: none;
                z-index: 999;
                max-height: 80vh;
                overflow-y: auto;
            }
            
            .dashboard-menu.show {
                display: flex;
            }
            
            .dashboard-menu li {
                width: 100%;
            }
            
            .dashboard-menu a {
                flex-direction: row;
                justify-content: flex-start;
                padding: 15px;
                font-size: 1rem;
            }
            
            .dashboard-menu i {
                margin-right: 15px;
                margin-bottom: 0;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .calendar-container {
                padding: 15px;
            }
            
            #calendar {
                min-height: 400px;
            }
            
            .compromisso-actions {
                opacity: 1 !important; /* Mostra sempre em mobile */
            }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 70px;
            }
            
            .navbar-brand-dashboard {
                transform: scale(1.6);
            }
            
            .welcome-card {
                padding: 20px;
            }
            
            .welcome-card h1 {
                font-size: 1.6rem;
            }
            
            .agenda-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .modal-body {
                padding: 20px;
                max-height: 60vh;
            }
            
            .compromisso-actions {
                flex-direction: column;
            }
            
            .btn-compromisso {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 576px) {
            .navbar-brand-dashboard {
                transform: scale(1.4);
            }
            
            .fc .fc-toolbar {
                flex-direction: column;
                gap: 10px;
            }
            
            .fc .fc-toolbar-title {
                font-size: 1.1rem;
            }
            
            .compromissos-container {
                max-height: 400px;
            }
            
            .modal-dialog {
                margin: 5px;
            }
        }

        /* Scrollbar Personalizada */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }

        /* Prevenir zoom no iOS */
        @media (max-width: 768px) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Navbar Dashboard -->
    <nav class="navbar navbar-dashboard">
        <div class="container-fluid">
            <div class="d-flex align-items-center w-100">
                <!-- Logo -->
                <a class="navbar-brand-dashboard" href="profissional-dashboard.html">
                    <img src="logoscanhub.png" alt="ScanHub">
                </a>

                <!-- Bot√£o Menu Mobile -->
                <button class="mobile-menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- User Info -->
                <div class="user-info-mobile ms-auto">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <div class="user-details d-none d-md-block ms-2">
                        <h5 id="userName">Carregando...</h5>
                        <small>ID: <span id="userId">---</span></small>
                    </div>
                </div>

                <!-- Bot√£o Logout -->
                <button class="btn btn-outline-danger btn-sm ms-3" id="btnLogout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="d-none d-md-inline">Sair</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Menu Dashboard -->
    <div class="container-fluid">
        <ul class="dashboard-menu" id="dashboardMenu">
            <li>
                <a href="profissional-dashboard.html">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="perfil-profissional.html">
                    <i class="fas fa-user"></i>
                    <span>Perfil</span>
                </a>
            </li>
            <li>
                <a href="meus-clientes.html">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
            </li>
            <li>
                <a href="financeiro.html">
                    <i class="fas fa-chart-line"></i>
                    <span>Financeiro</span>
                </a>
            </li>
            <li>
                <a href="#" class="active">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Agenda</span>
                </a>
            </li>
            <li>
                <a href="catalogo.html">
                    <i class="fas fa-boxes"></i>
                    <span>Cat√°logo</span>
                </a>
            </li>
            <li>
                <a href="pedidos.html">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Pedidos</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-crown"></i>
                    <span>Assinatura</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Welcome Card -->
        <div class="welcome-card">
            <h1>Agenda üìÖ</h1>
            <p>Gerencie seus compromissos e n√£o esque√ßa de nada!</p>
        </div>

        <!-- Agenda Header -->
        <div class="agenda-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="agenda-tabs" id="agendaTabs">
                        <button class="agenda-tab active" data-view="calendario">
                            <i class="fas fa-calendar-alt me-2"></i>Calend√°rio
                        </button>
                        <button class="agenda-tab" data-view="lista">
                            <i class="fas fa-list me-2"></i>Lista
                        </button>
                        <button class="agenda-tab" data-view="anotacoes">
                            <i class="fas fa-sticky-note me-2"></i>Anota√ß√µes
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary-action" onclick="abrirModalCompromisso()">
                        <i class="fas fa-plus"></i> Novo Compromisso
                    </button>
                </div>
            </div>
        </div>

        <!-- Calend√°rio View -->
        <div class="calendar-container" id="viewCalendario">
            <div id="calendar"></div>
        </div>

        <!-- Lista View -->
        <div class="compromissos-container d-none" id="viewLista">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Todos os Compromissos</h5>
                <select class="form-select form-select-sm" style="width: auto;" id="filterStatus">
                    <option value="">Todos status</option>
                    <option value="confirmado">Confirmados</option>
                    <option value="pendente">Pendentes</option>
                    <option value="cancelado">Cancelados</option>
                </select>
            </div>
            
            <div id="compromissosList">
                <!-- Compromissos ser√£o carregados aqui -->
                <div class="empty-state">
                    <i class="fas fa-calendar-check"></i>
                    <h4>Nenhum compromisso agendado</h4>
                    <p>Comece criando seu primeiro compromisso</p>
                </div>
            </div>
        </div>

        <!-- Anota√ß√µes View -->
        <div class="anotacoes-container d-none" id="viewAnotacoes">
            <h5 class="mb-3">Anota√ß√µes Gerais</h5>
            <p class="text-muted mb-3">Escreva aqui suas anota√ß√µes, ideias, coisas a comprar, lembretes gerais...</p>
            
            <textarea class="anotacoes-textarea" id="anotacoesText" 
                      placeholder="Digite suas anota√ß√µes aqui... Elas ser√£o salvas automaticamente."></textarea>
            
            <div class="d-flex justify-content-end mt-3">
                <small class="text-muted" id="anotacoesStatus">Salvando...</small>
            </div>
        </div>
    </div>

    <!-- Modal Compromisso -->
    <div class="modal fade" id="modalCompromisso" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Novo Compromisso</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formCompromisso">
                        <input type="hidden" id="compromissoId">
                        
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label class="form-label">T√≠tulo *</label>
                                <input type="text" class="form-control" id="titulo" required 
                                       placeholder="Ex: Instala√ß√£o ar condicionado, Reuni√£o com cliente...">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Tipo *</label>
                                <select class="form-select" id="tipo" required>
                                    <option value="servico">Servi√ßo</option>
                                    <option value="visita">Visita</option>
                                    <option value="reuniao">Reuni√£o</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Data *</label>
                                <input type="date" class="form-control" id="data" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Hora In√≠cio *</label>
                                <input type="time" class="form-control" id="horaInicio" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Hora Fim</label>
                                <input type="time" class="form-control" id="horaFim">
                            </div>
                        </div>

                       <div class="row mb-3">
    <div class="col-md-6">
        <label class="form-label">Cliente (opcional)</label>
        <input type="text" class="form-control" id="cliente" 
               placeholder="Digite o nome do cliente...">
    </div>
    <div class="col-md-6">
        <label class="form-label">Servi√ßo (opcional)</label>
        <input type="text" class="form-control" id="servico" 
               placeholder="Digite o nome do servi√ßo...">
    </div>
</div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">N¬∫ Pedido (opcional)</label>
                                <input type="text" class="form-control" id="pedidoNumero" 
                                       placeholder="Ex: PED-001">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status *</label>
                                <select class="form-select" id="status" required>
                                    <option value="pendente">Pendente</option>
                                    <option value="confirmado">Confirmado</option>
                                    <option value="cancelado">Cancelado</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Local/Endere√ßo (opcional)</label>
                            <input type="text" class="form-control" id="local" 
                                   placeholder="Ex: Rua das Flores, 123 - Centro">
                        </div>

                        <div class="mb-4">
                            <label class="form-label">üìù Anota√ß√µes/Detalhes *</label>
                            <textarea class="form-control" id="anotacoes" rows="4" required
                                      placeholder="Detalhes importantes, materiais necess√°rios, observa√ß√µes..."></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Lembrete (opcional)</label>
                            <select class="form-select" id="lembrete">
                                <option value="">Sem lembrete</option>
                                <option value="15">15 minutos antes</option>
                                <option value="30">30 minutos antes</option>
                                <option value="60">1 hora antes</option>
                                <option value="1440">1 dia antes</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary-action" id="btnSalvarCompromisso">
                        <i class="fas fa-save me-2"></i>Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales-all.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
   <script type="module">
// Import Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { 
    getAuth, 
    onAuthStateChanged,
    signOut 
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { 
    getFirestore, 
    doc, 
    getDoc,
    collection,
    addDoc,
    updateDoc,
    deleteDoc,
    getDocs,
    query,
    where,
    orderBy,
    serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyAYqWTg2RAr4IbqxRsl58TZGQ9tKnyFK14",
    authDomain: "scanhub-ed512.firebaseapp.com",
    projectId: "scanhub-ed512",
    storageBucket: "scanhub-ed512.firebasestorage.app",
    messagingSenderId: "1083305018831",
    appId: "1:1083305018831:web:f7594d560439c8965c3eba"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ============================================
// VARI√ÅVEIS GLOBAIS
// ============================================
let currentUser = null;
let userData = null;
let compromissos = [];
let clientes = [];
let servicos = [];
let calendar = null;
let anotacoesTimeout = null;

// ============================================
// ELEMENTOS DOM - ATUALIZADOS
// ============================================
const loadingOverlay = document.getElementById('loadingOverlay');
const userName = document.getElementById('userName');
const userAvatar = document.getElementById('userAvatar');
const userId = document.getElementById('userId');
const btnLogout = document.getElementById('btnLogout');
const menuToggle = document.getElementById('menuToggle');
const dashboardMenu = document.getElementById('dashboardMenu');

// Views
const agendaTabs = document.getElementById('agendaTabs');
const viewCalendario = document.getElementById('viewCalendario');
const viewLista = document.getElementById('viewLista');
const viewAnotacoes = document.getElementById('viewAnotacoes');

// Calendar
const calendarEl = document.getElementById('calendar');

// Lista
const compromissosList = document.getElementById('compromissosList');
const filterStatus = document.getElementById('filterStatus');

// Anota√ß√µes
const anotacoesText = document.getElementById('anotacoesText');
const anotacoesStatus = document.getElementById('anotacoesStatus');

// Modal - ATUALIZADO: removidos selects, mantidos inputs de texto
const modalCompromisso = new bootstrap.Modal(document.getElementById('modalCompromisso'));
const modalTitle = document.getElementById('modalTitle');
const formCompromisso = document.getElementById('formCompromisso');
const btnSalvarCompromisso = document.getElementById('btnSalvarCompromisso');
const compromissoId = document.getElementById('compromissoId');
const titulo = document.getElementById('titulo');
const tipo = document.getElementById('tipo');
const data = document.getElementById('data');
const horaInicio = document.getElementById('horaInicio');
const horaFim = document.getElementById('horaFim');
const cliente = document.getElementById('cliente');           // Input de texto
const servico = document.getElementById('servico');           // Input de texto
const pedidoNumero = document.getElementById('pedidoNumero');
const status = document.getElementById('status');
const local = document.getElementById('local');
const anotacoesField = document.getElementById('anotacoes');
const lembrete = document.getElementById('lembrete');

// ============================================
// INICIALIZA√á√ÉO
// ============================================
onAuthStateChanged(auth, async (user) => {
    if (user) {
        currentUser = user;
        try {
            showLoading();
            const userRef = doc(db, "usuarios", user.uid);
            const userDoc = await getDoc(userRef);
            
            if (userDoc.exists()) {
                userData = userDoc.data();
                atualizarInterfaceUsuario(userData);
                await carregarDadosIniciais();
                inicializarSistema();
            }
        } catch (error) {
            console.error('Erro:', error);
            showNotification('Erro ao carregar dados', 'error');
        } finally {
            hideLoading();
        }
    } else {
        window.location.href = 'login.html';
    }
});

function atualizarInterfaceUsuario(data) {
    if (data.apelido) {
        userName.textContent = `Ol√°, ${data.apelido}`;
        userAvatar.textContent = data.apelido.charAt(0).toUpperCase();
    }
    
    if (data.idScanHub) {
        userId.textContent = data.idScanHub;
    }
}

async function carregarDadosIniciais() {
    await Promise.all([
        carregarCompromissos(),
        carregarClientes(),
        carregarServicos(),
        carregarAnotacoes()
    ]);
}

function inicializarSistema() {
    inicializarCalendario();
    inicializarEventListeners();
    inicializarFormulario();
    atualizarListaCompromissos();
}

// ============================================
// CARREGAMENTO DE DADOS
// ============================================
async function carregarCompromissos() {
    try {
        const q = query(
            collection(db, "compromissos"),
            where("profissionalId", "==", currentUser.uid),
            orderBy("data", "asc")
        );
        
        const querySnapshot = await getDocs(q);
        compromissos = [];
        
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            compromissos.push({
                id: doc.id,
                ...data,
                data: data.data || '',
                horaInicio: data.horaInicio || '',
                horaFim: data.horaFim || '',
                criadoEm: data.criadoEm || null,
                atualizadoEm: data.atualizadoEm || null
            });
        });
        
        // Ordenar por data e hora
        compromissos.sort((a, b) => {
            const dataA = new Date(`${a.data}T${a.horaInicio}`);
            const dataB = new Date(`${b.data}T${b.horaInicio}`);
            return dataA - dataB;
        });
        
    } catch (error) {
        console.error('Erro ao carregar compromissos:', error);
        compromissos = [];
    }
}

async function carregarClientes() {
    try {
        const q = query(
            collection(db, "clientes"),
            where("profissionalId", "==", currentUser.uid),
            orderBy("nome", "asc")
        );
        
        const querySnapshot = await getDocs(q);
        clientes = [];
        
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            clientes.push({
                id: doc.id,
                ...data
            });
        });
        
        // N√ÉO vamos mais popular select, pois agora usamos input de texto
        // Mantemos os dados para refer√™ncia se precisar
        
    } catch (error) {
        console.error('Erro ao carregar clientes:', error);
    }
}

async function carregarServicos() {
    try {
        const q = query(
            collection(db, "servicos"),
            where("profissionalId", "==", currentUser.uid),
            where("status", "==", "ativo"),
            orderBy("nome", "asc")
        );
        
        const querySnapshot = await getDocs(q);
        servicos = [];
        
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            servicos.push({
                id: doc.id,
                ...data
            });
        });
        
        // N√ÉO vamos mais popular select, pois agora usamos input de texto
        // Mantemos os dados para refer√™ncia se precisar
        
    } catch (error) {
        console.error('Erro ao carregar servi√ßos:', error);
    }
}

async function carregarAnotacoes() {
    try {
        const anotacoesRef = doc(db, "anotacoes", currentUser.uid);
        const anotacoesDoc = await getDoc(anotacoesRef);
        
        if (anotacoesDoc.exists()) {
            const data = anotacoesDoc.data();
            if (anotacoesText) {
                anotacoesText.value = data.texto || '';
                anotacoesStatus.textContent = 'Salvo automaticamente';
            }
        }
        
    } catch (error) {
        console.error('Erro ao carregar anota√ß√µes:', error);
    }
}

async function salvarAnotacoes() {
    if (!currentUser || !anotacoesText) return;
    
    try {
        const anotacoesRef = doc(db, "anotacoes", currentUser.uid);
        const anotacoesData = {
            texto: anotacoesText.value,
            profissionalId: currentUser.uid,
            atualizadoEm: serverTimestamp()
        };
        
        await updateDoc(anotacoesRef, anotacoesData, { merge: true });
        anotacoesStatus.textContent = 'Salvo ‚úì';
        
        setTimeout(() => {
            anotacoesStatus.textContent = 'Salvando automaticamente...';
        }, 2000);
        
    } catch (error) {
        console.error('Erro ao salvar anota√ß√µes:', error);
        anotacoesStatus.textContent = 'Erro ao salvar';
    }
}

// ============================================
// CALEND√ÅRIO
// ============================================
function inicializarCalendario() {
    if (!calendarEl) return;
    
    calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'pt-br',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        buttonText: {
            today: 'Hoje',
            month: 'M√™s',
            week: 'Semana',
            day: 'Dia'
        },
        events: compromissos.map(comp => ({
            id: comp.id,
            title: comp.titulo,
            start: `${comp.data}T${comp.horaInicio}`,
            end: comp.horaFim ? `${comp.data}T${comp.horaFim}` : null,
            extendedProps: {
                tipo: comp.tipo,
                status: comp.status,
                cliente: comp.clienteNome || comp.cliente || '',
                servico: comp.servicoNome || comp.servico || '',
                local: comp.local || '',
                anotacoes: comp.anotacoes || ''
            },
            backgroundColor: getEventColor(comp.tipo),
            borderColor: getEventColor(comp.tipo),
            textColor: 'white'
        })),
        eventClick: function(info) {
            const compromisso = compromissos.find(c => c.id === info.event.id);
            if (compromisso) {
                editarCompromisso(compromisso.id);
            }
        },
        dateClick: function(info) {
            abrirModalCompromissoComData(info.dateStr);
        },
        height: 'auto',
        contentHeight: 'auto',
        dayMaxEventRows: 3,
        eventTimeFormat: {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        }
    });
    
    calendar.render();
}

function getEventColor(tipo) {
    switch(tipo) {
        case 'servico': return '#44689a';
        case 'visita': return '#3498db';
        case 'reuniao': return '#f39c12';
        case 'outro': return '#7f8c8d';
        default: return '#44689a';
    }
}

function atualizarCalendario() {
    if (!calendar) return;
    
    calendar.removeAllEvents();
    compromissos.forEach(comp => {
        calendar.addEvent({
            id: comp.id,
            title: comp.titulo,
            start: `${comp.data}T${comp.horaInicio}`,
            end: comp.horaFim ? `${comp.data}T${comp.horaFim}` : null,
            extendedProps: {
                tipo: comp.tipo,
                status: comp.status,
                cliente: comp.clienteNome || comp.cliente || '',
                servico: comp.servicoNome || comp.servico || '',
                local: comp.local || '',
                anotacoes: comp.anotacoes || ''
            },
            backgroundColor: getEventColor(comp.tipo),
            borderColor: getEventColor(comp.tipo),
            textColor: 'white'
        });
    });
}

// ============================================
// LISTA DE COMPROMISSOS
// ============================================
function atualizarListaCompromissos() {
    if (!compromissosList) return;
    
    const statusFilter = filterStatus ? filterStatus.value : '';
    
    let compromissosFiltrados = compromissos;
    if (statusFilter) {
        compromissosFiltrados = compromissos.filter(c => c.status === statusFilter);
    }
    
    compromissosList.innerHTML = '';
    
    if (compromissosFiltrados.length === 0) {
        const emptyState = document.createElement('div');
        emptyState.className = 'empty-state';
        emptyState.innerHTML = `
            <i class="fas fa-calendar-check"></i>
            <h4>Nenhum compromisso encontrado</h4>
            <p>${statusFilter ? 'Tente ajustar o filtro' : 'Comece criando seu primeiro compromisso'}</p>
        `;
        compromissosList.appendChild(emptyState);
        return;
    }
    
    compromissosFiltrados.forEach(comp => {
        const card = criarCardCompromisso(comp);
        compromissosList.appendChild(card);
    });
}

function criarCardCompromisso(comp) {
    const card = document.createElement('div');
    card.className = `compromisso-card ${comp.tipo}`;
    card.setAttribute('data-id', comp.id);
    
    const dataObj = new Date(comp.data);
    const dataFormatada = dataObj.toLocaleDateString('pt-BR');
    const horaFormatada = comp.horaInicio ? comp.horaInicio.substring(0, 5) : '';
    
    // Agora pegamos os nomes diretos dos campos clienteNome/cliente e servicoNome/servico
    const clienteNome = comp.clienteNome || comp.cliente || 'Sem cliente';
    const servicoNome = comp.servicoNome || comp.servico || '';
    
    const tipoText = {
        'servico': 'üîß Servi√ßo',
        'visita': 'üìç Visita',
        'reuniao': 'ü§ù Reuni√£o',
        'outro': 'üìå Outro'
    }[comp.tipo] || 'üìå Compromisso';
    
    const statusText = {
        'confirmado': 'Confirmado',
        'pendente': 'Pendente',
        'cancelado': 'Cancelado'
    }[comp.status] || 'Pendente';
    
    const statusClass = {
        'confirmado': 'confirmado',
        'pendente': 'pendente',
        'cancelado': 'cancelado'
    }[comp.status] || 'pendente';
    
    card.innerHTML = `
        <div class="compromisso-time">
            <i class="far fa-clock"></i>
            <span>${dataFormatada} ‚Ä¢ ${horaFormatada}</span>
            <span class="compromisso-badge ${statusClass} ms-auto">${statusText}</span>
        </div>
        <div class="compromisso-title">${comp.titulo}</div>
        <div class="compromisso-details">
            <span><i class="fas fa-user"></i> ${clienteNome}</span>
            ${servicoNome ? `<span><i class="fas fa-tools"></i> ${servicoNome}</span>` : ''}
            ${comp.local ? `<span><i class="fas fa-map-marker-alt"></i> ${comp.local.substring(0, 30)}${comp.local.length > 30 ? '...' : ''}</span>` : ''}
            ${comp.pedidoNumero ? `<span><i class="fas fa-clipboard-list"></i> ${comp.pedidoNumero}</span>` : ''}
            <span><i class="fas fa-tag"></i> ${tipoText}</span>
        </div>
        ${comp.anotacoes ? `<div class="mt-2 text-muted small"><i class="fas fa-sticky-note"></i> ${comp.anotacoes.substring(0, 80)}${comp.anotacoes.length > 80 ? '...' : ''}</div>` : ''}
        
        <!-- BOT√ïES DE A√á√ÉO -->
        <div class="compromisso-actions">
            <button class="btn-compromisso btn-editar-compromisso" onclick="event.stopPropagation(); editarCompromisso('${comp.id}')">
                <i class="fas fa-edit"></i> Editar
            </button>
            <button class="btn-compromisso btn-excluir-compromisso" onclick="event.stopPropagation(); excluirCompromisso('${comp.id}')">
                <i class="fas fa-trash"></i> Excluir
            </button>
        </div>
    `;
    
    card.addEventListener('click', (e) => {
        // N√£o abrir edi√ß√£o se clicou em um bot√£o
        if (!e.target.closest('.btn-compromisso')) {
            editarCompromisso(comp.id);
        }
    });
    
    return card;
}

// ============================================
// FUN√á√ïES GLOBAIS
// ============================================
window.excluirCompromisso = async function(id) {
    if (!confirm('Tem certeza que deseja excluir este compromisso?\n\nEsta a√ß√£o n√£o pode ser desfeita.')) {
        return;
    }
    
    try {
        showLoading();
        
        const compRef = doc(db, "compromissos", id);
        await deleteDoc(compRef);
        
        // Remover localmente
        const index = compromissos.findIndex(c => c.id === id);
        if (index !== -1) {
            compromissos.splice(index, 1);
        }
        
        // Atualizar interface
        atualizarCalendario();
        atualizarListaCompromissos();
        
        showNotification('Compromisso exclu√≠do com sucesso!', 'success');
        
    } catch (error) {
        console.error('Erro ao excluir compromisso:', error);
        showNotification('Erro ao excluir compromisso. Tente novamente.', 'error');
    } finally {
        hideLoading();
    }
};

// ============================================
// CRUD COMPROMISSOS - AJUSTADO PARA INPUTS DE TEXTO
// ============================================
window.abrirModalCompromisso = function(compId = null) {
    resetarModal();
    
    if (compId) {
        // Modo edi√ß√£o
        const comp = compromissos.find(c => c.id === compId);
        if (!comp) return;
        
        preencherModal(comp);
        modalTitle.textContent = 'Editar Compromisso';
    } else {
        // Modo cria√ß√£o
        modalTitle.textContent = 'Novo Compromisso';
        
        // Preencher data e hora atual
        const hoje = new Date();
        data.value = hoje.toISOString().split('T')[0];
        horaInicio.value = hoje.getHours().toString().padStart(2, '0') + ':00';
    }
    
    modalCompromisso.show();
};

window.abrirModalCompromissoComData = function(dateStr) {
    resetarModal();
    modalTitle.textContent = 'Novo Compromisso';
    data.value = dateStr;
    
    // Hora padr√£o 09:00
    horaInicio.value = '09:00';
    
    modalCompromisso.show();
};

function resetarModal() {
    formCompromisso.reset();
    compromissoId.value = '';
    
    // Remover atributos data-*
    if (cliente) {
        cliente.removeAttribute('data-cliente-id');
    }
    if (servico) {
        servico.removeAttribute('data-servico-id');
    }
    
    // Preencher data e hora padr√£o
    const hoje = new Date();
    if (!data.value) data.value = hoje.toISOString().split('T')[0];
    if (!horaInicio.value) horaInicio.value = '09:00';
    
    // Status padr√£o
    status.value = 'pendente';
    tipo.value = 'servico';
}

function preencherModal(comp) {
    if (!comp) return;
    
    compromissoId.value = comp.id;
    titulo.value = comp.titulo || '';
    tipo.value = comp.tipo || 'servico';
    data.value = comp.data || '';
    horaInicio.value = comp.horaInicio || '';
    horaFim.value = comp.horaFim || '';
    
    // Agora usamos os inputs de texto simples
    cliente.value = comp.clienteNome || comp.cliente || '';
    servico.value = comp.servicoNome || comp.servico || '';
    
    pedidoNumero.value = comp.pedidoNumero || '';
    status.value = comp.status || 'pendente';
    local.value = comp.local || '';
    anotacoesField.value = comp.anotacoes || '';
    lembrete.value = comp.lembrete || '';
}

async function salvarCompromisso() {
    // Valida√ß√£o
    if (!titulo.value.trim()) {
        showNotification('Informe um t√≠tulo', 'warning');
        titulo.focus();
        return;
    }
    
    if (!data.value) {
        showNotification('Informe a data', 'warning');
        data.focus();
        return;
    }
    
    if (!horaInicio.value) {
        showNotification('Informe a hora de in√≠cio', 'warning');
        horaInicio.focus();
        return;
    }
    
    if (!anotacoesField.value.trim()) {
        showNotification('Informe as anota√ß√µes/detalhes', 'warning');
        anotacoesField.focus();
        return;
    }
    
    try {
        showLoading();
        if (btnSalvarCompromisso) {
            btnSalvarCompromisso.disabled = true;
            btnSalvarCompromisso.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Salvando...';
        }
        
        // Preparar dados - SIMPLIFICADO PARA INPUTS DE TEXTO
        const compromissoData = {
            titulo: titulo.value.trim(),
            tipo: tipo.value,
            data: data.value,
            horaInicio: horaInicio.value,
            horaFim: horaFim.value || null,
            
            // Guarda o texto digitado diretamente
            cliente: cliente.value.trim() || null,       // ‚Üê Texto digitado
            servico: servico.value.trim() || null,       // ‚Üê Texto digitado
            
            // Mant√©m compatibilidade com vers√£o antiga se necess√°rio
            clienteNome: cliente.value.trim() || null,
            servicoNome: servico.value.trim() || null,
            
            pedidoNumero: pedidoNumero.value || null,
            status: status.value,
            local: local.value.trim() || null,
            anotacoes: anotacoesField.value.trim(),
            lembrete: lembrete.value || null,
            profissionalId: currentUser.uid,
            profissionalNome: userData?.nomeCompleto || userData?.apelido || 'Profissional',
            atualizadoEm: serverTimestamp()
        };
        
        const compId = compromissoId.value;
        
        if (compId) {
            // Atualizar
            const compRef = doc(db, "compromissos", compId);
            await updateDoc(compRef, compromissoData);
            
            // Atualizar localmente
            const index = compromissos.findIndex(c => c.id === compId);
            if (index !== -1) {
                compromissos[index] = { ...compromissos[index], ...compromissoData };
            }
            
            showNotification('Compromisso atualizado com sucesso!', 'success');
        } else {
            // Criar novo
            compromissoData.criadoEm = serverTimestamp();
            const docRef = await addDoc(collection(db, "compromissos"), compromissoData);
            compromissoData.id = docRef.id;
            compromissos.push(compromissoData);
            
            showNotification('Compromisso criado com sucesso!', 'success');
        }
        
        // Fechar modal
        modalCompromisso.hide();
        
        // Atualizar interface
        atualizarCalendario();
        atualizarListaCompromissos();
        
    } catch (error) {
        console.error('Erro ao salvar compromisso:', error);
        showNotification('Erro ao salvar compromisso. Tente novamente.', 'error');
    } finally {
        hideLoading();
        if (btnSalvarCompromisso) {
            btnSalvarCompromisso.disabled = false;
            btnSalvarCompromisso.innerHTML = '<i class="fas fa-save me-2"></i>Salvar';
        }
    }
}

window.editarCompromisso = function(id) {
    abrirModalCompromisso(id);
};

// ============================================
// EVENT LISTENERS
// ============================================
function inicializarEventListeners() {
    // Menu mobile
    if (menuToggle) {
        menuToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            dashboardMenu.classList.toggle('show');
            const icon = menuToggle.querySelector('i');
            if (icon) {
                if (dashboardMenu.classList.contains('show')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
        });
    }
    
    // Fechar menu ao clicar fora
    document.addEventListener('click', (e) => {
        if (dashboardMenu && menuToggle) {
            if (!dashboardMenu.contains(e.target) && !menuToggle.contains(e.target)) {
                dashboardMenu.classList.remove('show');
                const icon = menuToggle.querySelector('i');
                if (icon) {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
        }
    });
    
    // Logout
    if (btnLogout) {
        btnLogout.addEventListener('click', async () => {
            try {
                await signOut(auth);
                window.location.href = 'login.html';
            } catch {
                showNotification('Erro ao sair. Tente novamente.', 'error');
            }
        });
    }
    
    // Tabs da agenda
    if (agendaTabs) {
        const tabBtns = agendaTabs.querySelectorAll('.agenda-tab');
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                tabBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const view = this.getAttribute('data-view');
                
                // Esconder todas as views
                viewCalendario.classList.add('d-none');
                viewLista.classList.add('d-none');
                viewAnotacoes.classList.add('d-none');
                
                // Mostrar view selecionada
                document.getElementById(`view${view.charAt(0).toUpperCase() + view.slice(1)}`).classList.remove('d-none');
            });
        });
    }
    
    // Filtro de status
    if (filterStatus) {
        filterStatus.addEventListener('change', atualizarListaCompromissos);
    }
    
    // Salvar compromisso
    if (btnSalvarCompromisso) {
        btnSalvarCompromisso.addEventListener('click', salvarCompromisso);
    }
    
    // Salvar anota√ß√µes automaticamente
    if (anotacoesText) {
        anotacoesText.addEventListener('input', () => {
            anotacoesStatus.textContent = 'Salvando...';
            
            clearTimeout(anotacoesTimeout);
            anotacoesTimeout = setTimeout(salvarAnotacoes, 1000);
        });
    }
}

function inicializarFormulario() {
    // Data m√≠nima: hoje
    const hoje = new Date().toISOString().split('T')[0];
    if (data) {
        data.min = hoje;
    }
}

// ============================================
// FUN√á√ïES AUXILIARES
// ============================================
function showLoading() {
    if (loadingOverlay) {
        loadingOverlay.classList.add('active');
    }
}

function hideLoading() {
    if (loadingOverlay) {
        loadingOverlay.classList.remove('active');
    }
}

function showNotification(message, type = 'success') {
    // Remover notifica√ß√µes anteriores
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(n => n.remove());
    
    // Criar nova notifica√ß√£o
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
        ${message}
    `;
    
    document.body.appendChild(notification);
    
    // Remover ap√≥s 5 segundos
    setTimeout(() => {
        notification.remove();
    }, 5000);
}

// Inicializar quando o DOM carregar
document.addEventListener('DOMContentLoaded', function() {
    // Adicionar estilo para notifica√ß√µes
    const style = document.createElement('style');
    style.textContent = `
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            animation: slideIn 0.3s ease;
            max-width: 90vw;
            word-break: break-word;
            display: flex;
            align-items: center;
        }
        .notification.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        .notification.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        .notification.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    `;
    document.head.appendChild(style);
    
    // Configurar data e hora iniciais
    const hoje = new Date();
    if (data) data.value = hoje.toISOString().split('T')[0];
    if (horaInicio) horaInicio.value = '09:00';
});
</script>
</body>
</html>